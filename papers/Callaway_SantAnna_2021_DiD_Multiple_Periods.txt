Difference-in-Differences with Multiple Time Periods*
Brantly Callaway¬Ñ

Pedro H. C. Sant‚ÄôAnna

December 1, 2020

Abstract
In this article, we consider identification, estimation, and inference procedures for treatment effect
parameters using Difference-in-Differences (DiD) with (i) multiple time periods, (ii) variation in treatment timing, and (iii) when the ‚Äúparallel trends assumption‚Äù holds potentially only after conditioning
on observed covariates. We show that a family of causal effect parameters are identified in staggered DiD setups, even if differences in observed characteristics create non-parallel outcome dynamics
between groups. Our identification results allow one to use outcome regression, inverse probability
weighting, or doubly-robust estimands. We also propose different aggregation schemes that can be
used to highlight treatment effect heterogeneity across different dimensions as well as to summarize
the overall effect of participating in the treatment. We establish the asymptotic properties of the
proposed estimators and prove the validity of a computationally convenient bootstrap procedure to
conduct asymptotically valid simultaneous (instead of pointwise) inference. Finally, we illustrate the
relevance of our proposed tools by analyzing the effect of the minimum wage on teen employment from
2001‚Äì2007. Open-source software is available for implementing the proposed methods.
JEL: C14, C21, C23, J23, J38.
Keywords: Difference-in-Differences, Dynamic Treatment Effects, Doubly Robust, Event Study, Variation in Treatment Timing, Treatment Effect Heterogeneity, Semi-Parametric.

*
First complete version: March 23, 2018. A previous version of this paper has been circulated with the title ‚ÄúDifferencein-Differences with Multiple Time Periods and an Application on the Minimum Wage and Employment‚Äù. We thank the
Editor, the Associate Editor, two anonymous referees, SteÃÅphane Bonhomme, Carol Caetano, Sebastian Calonico, Xiaohong
Chen, CleÃÅment de Chaisemartin, Xavier D‚ÄôHaultfoeuille, Bruno Ferman, John Gardner, Andrew Goodman-Bacon, Federico
Gutierrez, Sukjin Han, Hugo Jales, Andrew Johnston, Vishal Kamat, Qi Li, Tong Li, Jason Lindo, Catherine Maclean, Matt
Masten, Magne Mogstad, Tom Mroz, Aureo de Paula, Jonathan Roth, Donald Rubin, Bernhard Schmidpeter, Yuya Sasaki,
Na‚ÄôAma Shenhav, Tymon SloczynÃÅski, Sebastian Tello-Trillo, Alex Torgovitsky, Jeffrey Wooldridge, Haiqing Xu and several
seminar and conference audiences for comments and suggestions. Code to implement the methods proposed in the paper is
available in the R package did which is available on CRAN.
¬Ñ
Department of Economics, University of Georgia. Email: brantly.callaway@uga.edu
Department of Economics, Vanderbilt University. Email: pedro.h.santanna@vanderbilt.edu

1

1

Introduction

Difference-in-Differences (DiD) has become one of the most popular research designs used to evaluate
causal effects of policy interventions. In its canonical format, there are two time periods and two groups:
in the first period no one is treated, and in the second period some units are treated (the treated group),
and some units are not (the comparison group). If, in the absence of treatment, the average outcomes
for treated and comparison groups would have followed parallel paths over time (which is the so-called
parallel trends assumption), one can estimate the average treatment effect for the treated subpopulation
(ATT) by comparing the average change in outcomes experienced by the treated group to the average
change in outcomes experienced by the comparison group. Methodological extensions of DiD methods
often focus on this standard two periods, two groups setup; see, e.g., Heckman et al. (1997, 1998), Abadie
(2005), Athey and Imbens (2006), Qin and Zhang (2008), Bonhomme and Sauder (2011), de Chaisemartin
and D‚ÄôHaultf≈ìuille (2017), Botosaru and Gutierrez (2018), Callaway et al. (2018), and Sant‚ÄôAnna and
Zhao (2020).1
Many DiD empirical applications, however, deviate from the canonical DiD setup and have more than
two time periods and variation in treatment timing. In this article, we provide a unified framework for
average treatment effects in DiD setups with multiple time periods, variation in treatment timing, and
when the parallel trends assumption holds potentially only after conditioning on observed covariates. We
concentrate our attention on DiD with staggered adoption, i.e., to DiD setups such that once units are
treated, they remain treated in the following periods.
The core of our proposal relies on separating the DiD analysis into three separate steps: (i) identification of policy-relevant disaggregated causal parameters; (ii) aggregation of these parameters to form
summary measures of the causal effects; and (iii) estimation and inference about these different target
parameters. Our approach allows for estimation and inference on interpretable causal parameters allowing for arbitrary treatment effect heterogeneity and dynamic effects, thereby completely avoiding the
issues of interpreting results of standard two-way fixed effects (TWFE) regressions as causal effects in
DiD setups as pointed out by Borusyak and Jaravel (2017), de Chaisemartin and D‚ÄôHaultf≈ìuille (2020),
Goodman-Bacon (2019), Sun and Abraham (2020), and Athey and Imbens (2018). In addition, it adds
transparency and objectivity to the analysis (Rubin (2007, 2008)), and allows researchers to exploit a
variety of estimation methods to answer different questions of interest.
The identification step of the analysis provides a blueprint for the other steps. In this paper, we pay
particular attention to the disaggregated causal parameter that we call the group-time average treatment
effect, i.e., the average treatment effect for group g at time t, where a ‚Äúgroup‚Äù is defined by the time period
when units are first treated. In the canonical DiD setup with two periods and two groups, these parameters
reduce to the ATT which is typically the parameter of interest in that setup. An attractive feature of the
group-time average treatment effect parameters is that they do not directly restrict heterogeneity with
respect to observed covariates, the period in which units are first treated, or the evolution of treatment
effects over time. As a consequence, these easy-to-interpret causal parameters can be directly used for
learning about treatment effect heterogeneity, and/or to construct many other more aggregated causal
1
See Section 6 of Athey and Imbens (2006) and Theorem S1 in de Chaisemartin and D‚ÄôHaultf≈ìuille (2017) for notable
exceptions that cover multiple periods and multiple groups.

2

parameters. We view this level of generality and flexibility as one of the main advantages of our proposal.
We provide sufficient conditions related to treatment anticipation behavior and conditional parallel
trends under which these group-time average treatment effects are nonparametrically point-identified.
A unique feature of our framework is that it shows how researchers can flexibly incorporate covariates
into the staggered DiD setup with multiple groups and multiple periods. This is particularly important
in applications in which differences in observed characteristics create non-parallel outcome dynamics
between different groups ‚Äì in this case, unconditional DiD strategies are generally not appropriate to
recover sensible causal parameters of interest (Heckman et al., 1997, 1998; Abadie, 2005). We propose
three different types of DiD estimands in staggered treatment adoption setups: one based on outcome
regressions (Heckman et al., 1997, 1998), one based on inverse probability weighting (Abadie, 2005),
and one based on doubly-robust methods (Sant‚ÄôAnna and Zhao, 2020). We provide versions of these
estimands both for the case with panel data and for the case with repeated cross sections data. To the
best of our knowledge, this paper is the first to show how one can allow for covariate-specific trends across
groups in DiD setups with variation in treatment timing. Our results also highlight that, in practice, one
can rely on different types of parallel trends assumptions and allow some types of treatment anticipation
behavior; our proposed estimands explicitly reflect these assumptions.
Our framework acknowledges that in some applications there may be many group-time average treatment effects and researchers may want to aggregate them into different summary causal effect measures.
This characterizes the aggregation step of the analysis. We provide ways to aggregate the potentially
large number of group-time average treatment effects into a variety of intuitive summary parameters and
discuss specific aggregation schemes that can be used to highlight different sources of treatment effect
heterogeneity across groups and time periods. In particular, we consider aggregation schemes that deliver
a single overall treatment effect parameter with similarities to the ATT in the two period and two group
case as well as partial aggregations that highlight heterogeneity along certain dimensions such as (a) how
average treatment effects vary with length of exposure to the treatment (event-study-type estimands); (b)
how average treatment effects vary across treatment groups; and (c) how cumulative average treatment
effects evolve over calendar time. We also provide a formal discussion of the costs and benefits of balancing the sample in ‚Äúevent time‚Äù when analyzing dynamic treatment effects. Overall, our setup makes it
clear that, in general, the ‚Äúbest‚Äù aggregation scheme is application-specific as it depends on the type of
question one wants to answer.
Given that our identification results are constructive, we propose easy-to-use plug-in type (parametric)
estimators for the causal parameters of interest. Although the outcome regression, inverse probability
weighting and doubly-robust estimands are equivalent from the identification point of view, they suggest
different types of DiD estimators one can use in practice. Here, we note that using doubly-robust
estimators can be particularly attractive as they rely on less stringent modeling conditions than the
outcome regression and the inverse probability weighting procedures.
In order to conduct asymptotically valid inference, we justify the use of a computationally convenient multiplier-type bootstrap procedure. This approach can be used to obtain simultaneous confidence
bands for the group-time average treatment effects. Unlike commonly used pointwise confidence bands,
our simultaneous confidence bands asymptotically cover the entire path of the group-time average treatment effects with fixed probability and take into account the dependency across different group-time
3

average treatment effect estimators. Thus, our proposed confidence bands are arguably more suitable for
visualizing the overall estimation uncertainty than more traditional pointwise confidence intervals.
We illustrate the practical relevance of our proposal by analyzing the effect of the minimum wage on
teen employment. Here, we follow much empirical work on the effects of the minimum wage and exploit
having access to panel data and variation in treatment timing across states (e.g., Card and Krueger
(1994); Neumark and Wascher (2000, 2008); Dube et al. (2010), among many others) in order to estimate
the effect of the minimum wage on employment. Interestingly, in our setup, using our approach leads
to qualitatively different results than results from the TWFE estimator. This suggests that, at least
in certain applications, using methods that are robust to treatment effect heterogeneity can lead to
meaningful differences relative to more standard TWFE regressions.
Recent Related Literature: This paper is related to the recent and emerging literature on heterogeneous treatment effects in DiD and/or event studies with variation in treatment timing; see, e.g.,
de Chaisemartin and D‚ÄôHaultf≈ìuille (2020), Goodman-Bacon (2019), Imai et al. (2018), Borusyak and
Jaravel (2017), Athey and Imbens (2018) and Sun and Abraham (2020). All these papers present, among
other things, some negative results about the interpretation of parameters associated with standard
TWFE linear regression specifications; see also Laporte and Windmeijer (2005), Wooldridge (2005a),
Chernozhukov et al. (2013), and Gibbons et al. (2018) for earlier related results based on (one-way) fixedeffect estimators. Our proposed procedure completely bypasses the pitfalls highlighted in these papers as
we clearly separate the identification, aggregation and estimation/inference steps of the analysis.
These aforementioned papers also propose alternative DiD estimators that do not suffer from the
pitfalls associated with TWFE. Among these, perhaps the closest to our proposal are those of de Chaisemartin and D‚ÄôHaultf≈ìuille (2020), and Sun and Abraham (2020), though several major differences are
worth stressing.
de Chaisemartin and D‚ÄôHaultf≈ìuille (2020) is focused on recovering an instantaneous treatment effect
measure, while we pay particular attention to treatment effect dynamics. In fact, our framework allows one
to form families of different aggregate parameters in a unified manner. Second, while we pay particular
attention to the role played by pre-treatment covariates, de Chaisemartin and D‚ÄôHaultf≈ìuille (2020)
mainly focus on unconditional DiD designs. On the other hand, the setup in de Chaisemartin and
D‚ÄôHaultf≈ìuille (2020) is more general than ours as we consider staggered adoption designs and they
allow for more general treatment selection. Nonetheless, we note that the unconditional versions of our
parallel trends assumptions are weaker than the one in de Chaisemartin and D‚ÄôHaultf≈ìuille (2020), even
if one were to specialize their setup to staggered adoption designs.
Sun and Abraham (2020) proposes a parameter, cohort-specific average treatment effects, that translates our group-time average treatment effects from calendar time into event time. Sun and Abraham
(2020) proposes regression-based estimators of these parameters that have similar properties to our estimators in the specific case of staggered treatment adoption under an unconditional version of the parallel
trends assumption. However, our approach is more general in several respects. First, we allow for parallel
trends assumptions to hold after conditioning on covariates, and it is not clear how to adapt the regression
based estimators in Sun and Abraham (2020) to this case. Second, we consider a wide variety of possible
aggregations of group-time average treatment effects where Sun and Abraham (2020) focuses particularly
4

on the event study type of aggregation. Third, we make use of simultaneous inference procedures that
explicitly account for potential multiple-testing problems; Sun and Abraham (2020) focuses on pointwise
inference. On the other hand, we do not have any results highlighting the pitfalls associated with using
TWFE specifications with leads and lags of treatment indicators to conduct causal inference; these are
unique to Sun and Abraham (2020).
We also note that Athey and Imbens (2018) considers a staggered treatment adoption setup similar
to ours. However, the starting point of Athey and Imbens (2018) is an assumption that the treatment
adoption date is fully randomized which is stronger than our parallel trends assumptions. We also note
that Athey and Imbens (2018) abstracts away from the important role played by covariates in the DiD
analysis and does not consider aggregation schemes to summarize treatment effect heterogeneity like
we do. On the other hand, we stress that the main focus of their paper is on providing design-based
inference procedures for staggered DiD setups with random treatment dates. Their design-based inference
procedures complement our sampling-based inference procedures.
Organization of the paper: The remainder of this article is organized as follows. Section 2 presents
our main identification results. We discuss our different aggregation schemes in Section 3. Estimation
and inference procedures for the treatment effects of interest are presented in Section 4. We revisit the
effect of minimum wage on employment in Section 5. Section 6 concludes. Proofs as well as additional
methodological results are reported in the Appendix. In the Supplementary Appendix, we present proofs
for the results when only repeated cross-sections data is available, provide additional details about the
empirical application, and present a small scale Monte Carlo simulation to illustrate the finite sample
properties of our proposed estimators.2

2

Identification

2.1

Setup

We first introduce the notation we use throughout the article. We consider the case with T periods and
denote a particular time period by t where t = 1, . . . , T . In a canonical DiD setup, T = 2 and no one
is treated in period t = 1. Let Di,t be a binary variable equal to one if unit i is treated in period t and
equal to zero otherwise. We make the following assumption about the treatment process:
Assumption 1 (Irreversibility of Treatment). D1 = 0 almost surely (a.s.). For t = 2, . . . , T ,
Dt‚àí1 = 1 implies that Dt = 1 a.s..
Assumption 1 states that no one is treated at time t = 1, and that once a unit becomes treated,
that unit will remain treated in the next period.3 This assumption is also called staggered treatment

2

Supplementary Appendix is available at https://pedrohcgs.github.io/files/Callaway_SantAnna_2020_supp.pdf.
In applications, it can be the case that some units are already treated by the first time period. In our case, we would
drop these units; this is analogous to the case with two time periods. The reason to drop these units is that untreated
potential outcomes are never observed for this group which will imply that treatment effects are not identified for this group
nor are they useful as a comparison group under a parallel trends assumption.
3

5

adoption in the literature. We interpret this assumption as if units do not ‚Äúforget‚Äù about the treatment
experience.4
Define G as the time period when a unit first becomes treated. Under Assumption 1, for all units
that eventually participate in the treatment, G defines which ‚Äúgroup‚Äù they belong to. If a unit does not
participate in any time period, we arbitrarily set G = ‚àû. We define Gg to be a binary variable that is
equal to one if a unit is first treated in period g (i.e., Gi,g = 1{Gi = g}) and define C to be a binary
variable that is equal to one for units that do not participate in the treatment in any time period (i.e.,
Ci = 1{Gi = ‚àû} = 1‚àíDi,T ). Let gÃÑ = maxi=1,¬∑¬∑¬∑ ,n Gi be the maximum G in the dataset. Next, denote the
generalized propensity score as pg,s (X) = P (Gg = 1|X, Gg + (1 ‚àí Ds ) (1 ‚àí Gg ) = 1). Note that pg,s (X)
indicates the probability of being first treated at time g, conditional on pre-treatment covariates X and
on either being a member of group g (in this case, Gg = 1) or a member of the ‚Äúnot-yet-treated‚Äù group by
time s (in this case, (1‚àíDs )(1‚àíGg ) = 1). Many of our results use a specialized version of this generalized
propensity score, and, henceforth, we define pg (X) = pg,T (X) = P (Gg = 1|X, Gg + C = 1) which is the
probability of being first treated in period g conditional on covariates and either being a member of group
g or not participating in the treatment in any time period. Let G = supp(G)\ {gÃÑ} ‚äÜ {2, 3, . . . , T } denote
the support of G excluding gÃÑ.5 Likewise, let X = supp(X) ‚äÜ Rk denote the support of the pre-treatment
covariates. Finally, for a generic Œ¥ ‚â• 0, let GŒ¥ = G‚à© {2 + Œ¥, 3 + Œ¥, . . . , T }.
Next, we set up the potential outcomes framework. Here, we combine the dynamic potential outcomes
framework of Robins (1986, 1987) with the multi-stage treatment adoption setup discussed by Heckman
et al. (2016); see also Sianesi (2004). Let Yi,t (0) denote unit i‚Äôs untreated potential outcome at time t
if they remain untreated through time period T ; i.e., if they were not to participate in the treatment
across all available time periods. For g = 2, . . . , T , let Yi,t (g) denote the potential outcome that unit i
would experience at time t if they were to first become treated in time period g. Note that our potential
outcomes notation accounts for potential dynamic treatment selection, though it also accommodates (prespecified) treatment regimes (Murphy et al., 2001; Murphy, 2003). The observed and potential outcomes
for each unit i are related through
Yi,t = Yi,t (0) +

T
X

(Yi,t (g) ‚àí Yi,t (0)) ¬∑ Gi,g

(2.1)

g=2

In other words, we only observe one potential outcome path for each unit. For those that do not participate
in the treatment in any time period, observed outcomes are untreated potential outcomes in all periods.
For units that do participate in the treatment, observed outcomes are the unit-specific potential outcomes
corresponding to the particular time period when that unit adopts the treatment.
We also impose the following random sampling assumption.
Assumption 2 (Random Sampling). {Yi,1 , Y,i2 , . . . Yi,T , Xi , Di,1 , Di,2 , . . . , Di,T }ni=1 is independent and
identically distributed (iid).
Assumption 2 implies that we have access to panel data; our results extend essentially immediately
4

See Han (2020), de Chaisemartin and D‚ÄôHaultf≈ìuille (2020) and Bojinov et al. (2020) for alternative setups where
treatment can ‚Äúturn off‚Äù.
5
When there is a ‚Äúnever treated‚Äù set of units with G = ‚àû, G only excludes this group. When such ‚Äúnever-treated‚Äù
group is not available, we exclude the latest-treated group as there will be no valid untreated comparison group for them.

6

to the case with repeated cross sections data and this case is developed in Appendix B. Here, we note
that Assumption 2 allows us to view all potential outcomes as random. Furthermore, it does not impose
restrictions between potential outcomes and treatment allocation, nor does it restrict the time series
dependence of the observed random variables. On the other hand, Assumption 2 imposes that each
unit i is randomly drawn from a large population of interest. For an alternative design-based inference
approach, see Athey and Imbens (2018).
Henceforth, to keep the notation more concise, we will suppress the unit index i in our notation.

2.2

The Group-Time Average Treatment Effect Parameter

Given that different potential outcomes cannot be observed for the same unit at the same time, researchers
often focus on identifying and estimating some average causal effects. For instance, in the canonical DiD
setup with two time periods, the most popular treatment effect parameter of interest is the average
treatment effect on the treated, denoted by6
AT T = E[Y2 (2) ‚àí Y2 (0)|G2 = 1].
In this paper, we consider a natural generalization of the AT T that is suitable to setups with multiple
treatment groups and multiple time periods. More precisely, we use the average treatment effect for units
who are members of a particular group g at a particular time period t, denoted by
AT T (g, t) = E[Yt (g) ‚àí Yt (0)|Gg = 1],
as the main building block of our framework. We call this causal parameter the group-time average
treatment effect.
Note that the AT T (g, t) does not impose any restriction on treatment effect heterogeneity across
groups or across time. Thus, focusing on the family of AT T (g, t)‚Äôs allow us to analyze how average
treatment effects vary across different dimensions in a unified manner. For instance, by fixing a group g
and varying time t, one is able to highlight how average treatment effects evolve over time for that specific
group. By doing this for different groups, we can have a better understanding about how treatment effect
dynamics vary across groups. In addition, as we discuss in Section 3, one can build on the AT T (g, t)‚Äôs
to form more aggregated causal parameters that are constructed to answer specific questions like: (a)
What was the average effect of participating in the treatment across all groups that participated in the
treatment by time period T ? (b) Are average treatment effects heterogeneous across groups? (c) How do
average treatment effects vary by length of exposure to the treatment? (d) How do cumulative average
treatment effects evolve over calendar time? We view this level of generality and flexibility as one of the
main advantages of our framework that first focuses on the family of AT T (g, t)‚Äôs.

2.3

Identifying Assumptions

In order to identify the AT T (g, t) and their functionals, we impose the following assumptions.

6

Existence of expectations is assumed throughout.

7

Assumption 3 (Limited Treatment Anticipation). There is a known Œ¥ ‚â• 0 such that
E[Yt (g)|X, Gg = 1] = E[Yt (0)|X, Gg = 1] a.s. for all g ‚àà G, t ‚àà {1, . . . , T } such that t < g ‚àí Œ¥.
Assumption 3 restricts anticipation of the treatment for all ‚Äúeventually treated‚Äù groups. When Œ¥ = 0,
it imposes a ‚Äúno-anticipation‚Äù assumption, see, e.g., Abbring and van den Berg (2003) and Sianesi (2004).
This is likely to be the case when the treatment path is not a priori known and/or when units are not
the ones who ‚Äúchoose‚Äù treatment status. However, Assumption 3 also allows for anticipation behavior, as
long as we have a good understanding about the anticipation horizon Œ¥. For instance, if units anticipate
treatment by one period, Assumption 3 would hold with Œ¥ = 1; see, e.g., Laporte and Windmeijer (2005)
and Malani and Reif (2015) for the importance of accounting for potential anticipation behavior. Note
that, under Assumption 3, AT T (g, t) = 0 for all pre-treatment periods such that t < g ‚àí Œ¥.
Next, we consider two alternative assumptions that impose restrictions on the evolution of untreated
potential outcomes.
Assumption 4 (Conditional Parallel Trends based on a ‚ÄúNever-Treated‚Äù Group). Let Œ¥ be as defined in
Assumption 3. For each g ‚àà G and t ‚àà {2, . . . , T } such that t ‚â• g ‚àí Œ¥,
E[Yt (0) ‚àí Yt‚àí1 (0)|X, Gg = 1] = E[Yt (0) ‚àí Yt‚àí1 (0)|X, C = 1] a.s..
Assumption 5 (Conditional Parallel Trends based on ‚ÄúNot-Yet-Treated‚Äù Groups). Let Œ¥ be as defined
in Assumption 3. For each g ‚àà G and each (s, t) ‚àà {2, . . . , T } √ó {2, . . . , T } such that t ‚â• g ‚àí Œ¥ and
t + Œ¥ ‚â§ s < gÃÑ,
E[Yt (0) ‚àí Yt‚àí1 (0)|X, Gg = 1] = E[Yt (0) ‚àí Yt‚àí1 (0)|X, Ds = 0, Gg = 0] a.s..
Assumptions 4 and 5 are two different conditional parallel trends assumptions that generalize the
two-period parallel trends assumption to the case where there are multiple time periods and multiple
treatment groups; see, e.g., Heckman et al. (1997, 1998), Abadie (2005) and Sant‚ÄôAnna and Zhao (2020).
Both assumptions hold after conditioning on covariates X. This can be important in many applications in
economics particularly in cases where there are covariate specific trends in outcomes over time and when
the distribution of covariates is different across groups. For example, Heckman et al. (1997) motivates
conditional parallel trends assumptions in the context of evaluating a job training program. For evaluating
job training programs, the distribution of observed covariates such as age, employment history, and years
of education is often quite different between individuals who participate in job training and those that do
not. When the path of labor market outcomes (in the absence of participating in job training) depends
on these covariates, a conditional parallel trends becomes more plausible than an unconditional parallel
trends assumption. In fact, ignoring the presence of covariate-specific trends can result in important
biases when evaluating causal effects of policy interventions using unconditional DiD methods.
Assumptions 4 and 5 differ from each other depending on the comparison group one is willing to use
in a given application. More specifically, Assumption 4 states that, conditional on covariates, the average
outcomes for the group first treated in period g and for the ‚Äúnever-treated‚Äù group would have followed
parallel paths in the absence of treatment. Assumption 5 imposes conditional parallel trends between

8

group g and groups that are ‚Äúnot-yet-treated‚Äù by time t + Œ¥.7 Importantly, both of these assumptions
allow for covariate-specific trends and do not restrict the relationship between treatment timing and the
potential outcomes, Yt (g)‚Äôs. Thus, they are weaker than the randomization-based assumption made by
Athey and Imbens (2018). We also note that the unconditional versions of Assumptions 4 and 5 are
weaker than the parallel trends assumption imposed by de Chaisemartin and D‚ÄôHaultf≈ìuille (2020) and
Sun and Abraham (2020) as they impose fewer restrictions on the evolution of Yt (0) in pre-treatment
periods; see, e.g., Marcus and Sant‚ÄôAnna (2020) for a comparison.
In our view, practitioners may favor Assumption 4 with respect to Assumption 5 when there is a
sizable group of units that do not participate in the treatment in any period, and, at the same time,
these units are similar enough to the ‚Äúeventually treated‚Äù units. When a ‚Äúnever-treated‚Äù group of units
is not available or ‚Äútoo small‚Äù, researchers may favor Assumption 5 as it allows one to use more groups
as valid comparison units, which potentially leads to more informative inference procedures. However, it
is important to stress that favoring Assumption 5 with respect to Assumption 4 also involves potential
drawbacks. For instance, in the absence of treatment anticipation (Œ¥ = 0), Assumption 4 does not restrict
observed pre-treatment trends across groups, whereas Assumption 5 does; see, e.g., Marcus and Sant‚ÄôAnna
(2020). Not restricting pre-treatment trends may be particularly meaningful in applications where the
economic environment during the ‚Äúearly-periods‚Äù was potentially different from the ‚Äúlater-periods.‚Äù In
these cases, the outcomes of different groups may evolve in a non-parallel manner during ‚Äúearly-periods‚Äù,
perhaps because the groups were exposed to different shocks, while trends become parallel in the ‚Äúlaterperiods.‚Äù We recommend taking these trade-offs into account when deciding which conditional parallel
trends assumption is more appropriate for a given application.8
The final identifying assumption we impose is an overlap condition.
Assumption 6 (Overlap). For each t ‚àà {2, . . . , T }, g ‚àà G, there exist some Œµ > 0 such that P (Gg = 1) >
Œµ and pg,t (X) < 1 ‚àí Œµ a.s..
Assumption 6 extends the overlap assumption in Heckman et al. (1997, 1998), Abadie (2005), and
Sant‚ÄôAnna and Zhao (2020) to the multiple groups and multiple periods setup. It states that a positive
fraction of the population starts treatment in period g, and that, for all g and t, the generalized propensity
score is uniformly bounded away from one. Assumption 6 rules out ‚Äúirregular identification‚Äù, see, e.g.,
Khan and Tamer (2010).
Remark 1. Note that Assumption 3 and Assumption 4 (Assumption 5) are intrinsically connected. For
instance, when one imposes the ‚Äúno-anticipation‚Äù condition (so that Œ¥ = 0), Assumption 4 would then
impose conditional parallel trends only for post-treatment periods t ‚â• g. If one allows for anticipation
behavior (so that Œ¥ > 0), Assumption 4 would then impose conditional parallel trends in some pretreatment periods, too. In fact, the parallel trends assumptions become stronger as one increases Œ¥. To
7
Athey and Imbens (2006) and de Chaisemartin and D‚ÄôHaultf≈ìuille (2017) also consider using ‚Äúnot-yet-treated‚Äù units
as comparison groups in related DiD procedures.
8
It may be tempting to use statistical pre-tests to select between different versions of the parallel trends assumption.
However, the results of Roth (2020) show that such a practice can lead to important distortions when conducting inference.
Thus, we do not recommend following this path, but instead recommend taking the context of the application into account
in order to choose the appropriate parallel trends assumption.

9

the best of our knowledge, this trade-off between the strength of these assumptions has not been noticed
before.
Remark 2. In some applications, practitioners may not be comfortable with using ‚Äúnever-treated‚Äù units
as part of the comparison group because they behave very differently from the other ‚Äúeventually treated‚Äù
units. In these cases, practitioners could drop all ‚Äúnever-treated‚Äù units from the analysis and proceed with
Assumption 5.

2.4

Nonparametric Identification of the Group-Time Average Treatment Effects

In this section, we show that the family of group-time average treatment effects are nonparametrically
point-identified under the aforementioned assumptions. Furthermore, we show that one can use outcome
regression (OR), inverse probability weighting (IPW), or doubly robust (DR) estimands to recover the
AT T (g, t)‚Äôs. In addition, we also highlight the roles played by Assumption 3 and by Assumptions 4 and
5 when forming these different estimands.
Before formalizing all the results, we need to introduce some additional notation. Let mnev
g,t,Œ¥ (X) =
E [Yt ‚àí Yg‚àíŒ¥‚àí1 |X, C = 1] and mny
g,t,Œ¥ (X) = E [Yt ‚àí Yg‚àíŒ¥‚àí1 |X, Dt+Œ¥ = 0, Gg = 0]. These are population
outcome regressions for the never-treated group and for the ‚Äúnot-yet-treated‚Äù by time t + Œ¥ group. Let
Ô£ÆÔ£´
Ô£∂
Ô£π
pg (X) C
Ô£ØÔ£¨ Gg
Ô£∫
1 ‚àí pg (X) Ô£∑
nev
Ô£¨
Ô£∑
Ô£∫
AT Tipw
(g, t; Œ¥) = E Ô£Ø
(2.2)
Ô£∞Ô£≠ E [Gg ] ‚àí  pg (X) C  Ô£∏ (Yt ‚àí Yg‚àíŒ¥‚àí1 )Ô£ª ,
E
1 ‚àí pg (X)



Gg
nev
nev
AT Tor (g, t; Œ¥) = E
Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mg,t,Œ¥ (X) ,
(2.3)
E [Gg ]
Ô£π
Ô£ÆÔ£´
Ô£∂
pg (X) C
Ô£ØÔ£¨ Gg
Ô£∫
1 ‚àí pg (X) Ô£∑
nev
nev
Ô£∫
Ô£¨
Ô£∑
(2.4)
(g, t; Œ¥) = E Ô£Ø
AT Tdr
Ô£∞Ô£≠ E [Gg ] ‚àí  pg (X) C  Ô£∏ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mg,t,Œ¥ (X) Ô£ª .
E
1 ‚àí pg (X)
Analogously, let
Ô£∂
Ô£π
pg,t+Œ¥ (X) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
Ô£ØÔ£¨ Gg
Ô£∑
Ô£∫
1 ‚àí pg,t+Œ¥ (X)
ny
Ô£¨
Ô£∑
Ô£∫
AT Tipw
(g, t; Œ¥) = E Ô£Ø
(2.5)
Ô£∞Ô£≠ E [Gg ] ‚àí  pg,t+Œ¥ (X) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )  Ô£∏ (Yt ‚àí Yg‚àíŒ¥‚àí1 )Ô£ª ,
E
1 ‚àí pg,t+Œ¥ (X)



Gg
ny
ny
AT Tor (g, t; Œ¥) = E
Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mg,t,Œ¥ (X) ,
(2.6)
E [Gg ]
Ô£ÆÔ£´
Ô£∂
Ô£π
pg,t+Œ¥ (X) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
Ô£∫
Ô£∑
Ô£ØÔ£¨ Gg
1 ‚àí pg,t+Œ¥ (X)
ny
Ô£¨
Ô£∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mny (X) Ô£∫ .


‚àí
AT Tdr
(g, t; Œ¥) = E Ô£Ø
g,t,Œ¥
Ô£ª
Ô£∞Ô£≠ E [Gg ]
pg,t+Œ¥ (X) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg ) Ô£∏
E
1 ‚àí pg,t+Œ¥ (X)
(2.7)
Ô£ÆÔ£´

With some abuse of notation, we write gÃÑ ‚àí Œ¥ = ‚àû for any non-negative Œ¥ whenever gÃÑ = ‚àû.

10

Theorem 1. Let Assumptions 1, 2, 3 and 6 hold.
(i) If Assumption 4 holds, then, for all g and t such that g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥} and t ‚â• g ‚àí Œ¥,
nev
nev
nev
AT T (g, t) = AT Tipw
(g, t; Œ¥) = AT Tor
(g, t; Œ¥) = AT Tdr
(g, t; Œ¥) .

(ii) If Assumption 5 holds, then, for all g and t such that g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥} and g‚àíŒ¥ ‚â§ t < gÃÑ‚àíŒ¥,
ny
ny
ny
AT T (g, t) = AT Tipw
(g, t; Œ¥) = AT Tor
(g, t; Œ¥) = AT Tdr
(g, t; Œ¥) .

Theorem 1 is the first main result of this paper. It provides powerful identification results that
extend the DiD identification results based on the outcome regression approach of Heckman et al. (1997,
1998), the IPW approach of Abadie (2005), and the DR approach of Sant‚ÄôAnna and Zhao (2020) to
the multiple-periods, multiple groups setup. In other words, Theorem 1 says that, from an identification
point of view, one can recover the AT T (g, t)‚Äôs by exploiting different parts of the data generating process:
the OR approach only relies on modeling the conditional expectation of the outcome evolution for the
comparison groups, the IPW approach relies on modeling the conditional probability of being in group
g, whereas the DR approach exploits both OR and IPW components.
In order to extend the results of Heckman et al. (1997, 1998), Abadie (2005), and Sant‚ÄôAnna and Zhao
(2020) to the multiple groups, multiple periods framework, we have to address two different challenges: one
associated with an appropriate reference time period and one associated with an appropriate comparison
group. Theorem 1 highlights how a solution to these challenges is directly connected to the limited
anticipation and the conditional parallel trends assumptions. More specifically, Theorem 1 says that we
can use the time period t = g ‚àí Œ¥ ‚àí 1 as an appropriate reference time period under Assumption 3 and
either Assumption 4 or 5. This is the most recent time period when untreated potential outcomes are
observed for units in group g. Interestingly, the more treatment anticipation is allowed (i.e., the higher
Œ¥ is), the further back in time one needs to go.9 Theorem 1 also suggests that the choice of comparison
group is directly tied to the conditional parallel trends assumption one makes: under Assumption 4, one
can use ‚Äúnever treated‚Äù units as a fixed comparison group for all ‚Äúeventually treated‚Äù units; whereas,
under Assumption 5, one can use the ‚Äúnot-yet-treated by time t + Œ¥‚Äù units as a valid comparison group
for those who are first treated at time g. In this latter case, Theorem 1 also highlights that when all units
eventually gets treated (gÃÑ < ‚àû), one is only able to identify the AT T (g, t)‚Äôs for time periods before the
last treated group ‚Äúeffectively‚Äù starts their treatment, i.e., t < gÃÑ ‚àí Œ¥. In this case, one can not identify
the AT T (g, t) for the last treated cohort, too.
Finally, we note that when pre-treatment covariates play no role in identification (i.e., Assumptions
3, 4, and 5 hold unconditionally on X), (2.2)-(2.4) collapse to
nev
AT Tunc
(g, t; Œ¥) = E[Yt ‚àí Yg‚àíŒ¥‚àí1 |Gg = 1] ‚àí E[Yt ‚àí Yg‚àíŒ¥‚àí1 |C = 1],

(2.8)

and (2.5)-(2.7) collapse to
ny
AT Tunc
(g, t; Œ¥) = E[Yt ‚àí Yg‚àíŒ¥‚àí1 |Gg = 1] ‚àí E[Yt ‚àí Yg‚àíŒ¥‚àí1 |Dt+Œ¥ = 0].

9

As mentioned in Remark 1, as one allows Œ¥ to increase, Assumptions 4 and 5 becomes more restrictive.

11

(2.9)

These expressions for AT T (g, t) clearly resemble the one for AT T in the canonical two-periods and twogroups case. As in that case, the average effect of participating in the treatment for units in group g is
identified by taking the path of outcomes (i.e., the change in outcomes between the most recent period
before they were affected by the treatment and the current period) actually experienced by that group
and adjusting it by the path of outcomes experienced by a comparison group. Under the parallel trends
assumption, this latter path is the path of outcomes that units in group g would have experienced if they
had not participated in the treatment.
Remark 3. From (2.8) one can see that when Assumptions 3 and 4 hold unconditionally and there is
no-anticipation, the AT T (g, t) parameter can be obtained by first subsetting the data to only contain
observations at time t and g ‚àí 1, from units with either Gg = 1 or C = 1, and then, using only the
observations of this subset, running the (population) linear regression
Y = Œ±1g,t + Œ±2g,t ¬∑ Gg + Œ±3g,t ¬∑ 1 {T = t} + Œ≤ g,t ¬∑ (Gg √ó 1 {T = t}) + g,t .

(2.10)

It is then easy to verify that Œ≤ g,t = AT T (g, t). Note that one would need to consider different partitions
of the data to characterize different AT T (g, t) in terms of regression parameters. Alternatively, one could
use the interacted two-way fixed effects regression proposed by Sun and Abraham (2020).
Remark 4. When covariates are available, the Œ≤ÃÉ g,t coefficient of the population linear regression
Y = Œ±ÃÉ1g,t + Œ±ÃÉ2g,t ¬∑ Gg + Œ±ÃÉ3g,t ¬∑ 1 {T = t} + Œ≤ÃÉ g,t ¬∑ (Gg √ó 1 {T = t}) + Œ≥ÃÉ ¬∑ X + Àúg,t
that uses the same subset of data as in Remark 3 is, in general, not equal to AT T (g, t) unless one is
willing to assume (i) homogeneous (in X) treatment effects, i.e., E[Yt (g) ‚àí Yt (0)|Gg = 1, X] = E[Yt (g) ‚àí
Yt (0)|Gg = 1] a.s., and (ii) rule-out covariate-specific trends, i.e., for E [Yt ‚àí Yt‚àí1 |X, G] = E[Yt ‚àí Yt‚àí1 |G]
a.s. for all groups and time periods; see, e.g., SloczynÃÅski (2018) for a related discussion. The characterizations of AT T (g, t) discussed in Theorem 1 do not rely on these restrictive conditions.
Remark 5. Although the IPW, OR, and DR based estimands presented in Theorem 1 are identical from
an identification standpoint, this is not the case when one wants to estimate and make inference about
the AT T (g, t). As we discuss in Section 4, DiD estimators based on the DR estimands (2.4) and (2.7)
usually enjoy additional robustness against model-misspecifications when compared to the IPW and OR
estimands.
Remark 6. Theorem 1 suggests that we can identify AT T (g, t) only for groups in GŒ¥ ‚äÜ G which can
involve dropping some ‚Äúearly treated‚Äù groups due to anticipation effects. When Œ¥ = 0, i.e. when there is
no anticipation, GŒ¥ = G. Theorem 1 also suggests that we can identify AT T (g, t) only until t = T ‚àí Œ¥
because of potential treatment anticipation behavior. In applications where some units are known to never
participate in the treatment (including periods after time period T ), however, we can identify AT T (g, t)
up to t = T by using these units as a valid comparison group for all time periods t = T ‚àí Œ¥ + 1, . . . , T ,
provided that an appropriate parallel trends assumption is satisfied.
Remark 7. From Theorem 1 it is clear that pre-treatment covariates play a prominent role in our analysis. Importantly, Assumptions 4 and 5 suggest that researchers should include pre-treatment covariates
12

that are potentially associated with the outcome evolution of Y (0) during post-treatment periods. We explicitly rule out incorporating post-treatment covariates as they can potentially be affected by the treatment;
see, e.g., Wooldridge (2005b), for a related discussion under the unconfoundedness setup.

3

Summarizing Group-Time Average Treatment Effects

The previous section shows that we can identify the AT T (g, t)‚Äôs by restricting treatment anticipation
behavior and imposing a conditional parallel trends assumption. In many applications, the AT T (g, t)‚Äôs
can be the ultimate causal parameters of interest. They can be used to highlight treatment effect heterogeneity across different groups g, at different points in time t, and across different lengths of treatment
exposure, e = t ‚àí g. In other situations, however, researchers may want to combine these different
AT T (g, t)‚Äôs to form more aggregated causal parameters. For instance, if the number of groups and time
periods is relatively large, it may be challenging to interpret many group-time average treatment effects.
In this section, we consider different aggregation schemes for the AT T (g, t)‚Äôs that allow researchers
to form a variety of summary measures of the causal effects of a given policy. Our aggregation schemes
are of the form
Œ∏=

T
XX

w (g, t) ¬∑ AT T (g, t),

(3.1)

g‚ààG t=2

where w (g, t) are carefully-chosen (known or estimable) weighting functions specified by the researcher
such that Œ∏ can be used to address a well-posed empirical/policy question. Difference choices of w (g, t)
allows researchers to highlight different types of treatment effect heterogeneity. We pay particular attention to aggregations that result in a single overall treatment effect summary parameter as well as to
aggregations related to understanding dynamic effects as is commonly done in event-study analysis. Of
course, many other aggregated parameters of the type (3.1) can be easily constructed following our framework. We illustrate this point by also summarizing heterogeneity with respect to group or by calendar
time.
Before proceeding with the discussion on how to construct these different aggregated parameters, it is
worth revisiting the two most popular treatment effect summary measures used by practitioners in DiD
setups. These are based on the ‚Äústatic‚Äù and ‚Äúdynamic‚Äù two-way fixed effects (TWFE) linear regression
specifications
Yi,t = Œ±t + Œ±g + Œ≤Di,t + i,t ,
Yi,t = Œ±t + Œ±g +

‚àí2
X

e
Œ¥eanticip ¬∑ Di,t
+

(3.2)
L
X

e
Œ≤e ¬∑ Di,t
+ vi,t ,

(3.3)

e=0

e=‚àíK

respectively, where Œ±t is a time fixed effect, Œ±g is a group fixed effect, i,t and vi,t are error terms,
e = 1 {t ‚àí G = e} is an an indicator for unit i being e periods away from initial treatment at time
Di,t
i

t, and K and L are positive constants. The parameter of interest in the static TWFE specification is
Œ≤, which, in applications, is typically interpreted as an overall effect of participating in the treatment
across groups and time periods. In the dynamic TWFE specification, practitioners usually focus on the
Œ≤e , e ‚â• 0, and these parameters are typically interpreted as measuring the effect of participating in the
13

treatment at different lengths of exposure to the treatment.
Despite the popularity of these specifications, recent research has shown that one must be very careful
in attaching a causal interpretation to these aggregated parameters. For instance, Borusyak and Jaravel
(2017), Goodman-Bacon (2019), de Chaisemartin and D‚ÄôHaultf≈ìuille (2020), and Athey and Imbens
(2018) have shown that, in general, Œ≤ recovers a weighted average of some underlying treatment effect
parameters but some of the weights on these parameters can be negative. This can potentially lead to
particularly problematic cases such as the effect of the treatment being positive for all units, but the
TWFE estimation resulting in estimates of Œ≤ that are negative. Even in cases where the weights are
not negative, the weights on underlying treatment effect parameters are entirely driven by the TWFE
estimation strategy and are sensitive to the size of each group, the timing of treatment, and the total
number of time periods (see Theorem 1 in Goodman-Bacon (2019)). The results in this section can be
used in exactly the same setup to identify a single interpretable average treatment effect parameter and,
thus, provide a way to circumvent the issues with the more common approach.
As discussed by Goodman-Bacon (2019), the ‚Äúnegative weight problem‚Äù associated with Œ≤ arises when
treatment effects evolve over time. Thus, one may wonder if such problems would still be present when
considering more general, dynamic specifications such as (3.3). Sun and Abraham (2020) shows that this
is still the case as the Œ≤e0 s associated with (3.3) do not recover easy-to-interpret causal parameters and
still generally suffer from the same sorts of ‚Äúnegative weighting problems.‚Äù In contrast to this, we provide
a simple way to directly aggregate our group-time average treatment effects into average treatment effects
across different lengths of exposure to the treatment.

3.1

Aggregations to Highlight Treatment Effect Heterogeneity

Next, we discuss several partial aggregations of the group-time average treatment effects in order to summarize different dimensions of treatment effect heterogeneity. Although there are additional possibilities,
we focus our discussion below on how to answer three particular questions: (a) How does the effect of
participating in the treatment vary with length of exposure to the treatment? (b) Do groups that are
treated earlier have, on average, higher/lower average treatment effects than groups that are treated
later? (c) What is the cumulative average treatment effect of the policy across all groups until some
particular point in time? Throughout this section, to avoid notation clutter, we assume that units do not
anticipate treatment, i.e., we consider the case where Assumption 3 holds with Œ¥ = 0. We also assume
that a ‚Äúnever treated‚Äù group is available.
3.1.1

How do average treatment effects vary with length of exposure to the treatment?

One of the most popular questions that arises in DiD setups with multiple time periods concerns treatment
effect dynamics: How does the effect of participating in the treatment vary with length of exposure to the
treatment? For instance, do average treatment effects increase/decrease with elapsed treatment time?
Indeed, answering this type of question is often the main motivation for using the event study regression
in (3.3), though, as we mentioned above, that sort of regression may not be suitable for such a task. In
this section, we propose an aggregation scheme that is suitable to highlight treatment effect heterogeneity
with respect to length of exposure to the treatment that does not suffer from the drawbacks associated
14

Table 1: Weights on AT T (g, t) for Aggregated Parameters
Parameter
Œ∏es (e)
bal
Œ∏es
(e, e0 )

Œ∏sel (gÃÉ)
Œ∏c (tÃÉ)
Œ∏ccumu (tÃÉ)
O
Œ∏W
O
Œ∏sel

w(g, t)
wees (g, t) = 1{g + e ‚â§ T }1{t ‚àí g = e}P (G = g|G + e ‚â§ T )
wees,bal (g, t) = 1{g + e0 ‚â§ T }1{t ‚àí g = e}P (G = g|G + e0 ‚â§ T )
wgÃÉs (g, t) = 1{t ‚â• g}1 {g = gÃÉ}/ (T ‚àí g + 1)

wtÃÉc (g, t) = 1{t ‚â• g}1 t = tÃÉ P (G = g|G ‚â§ t)

wtÃÉc,cumu (g, t) = 1{t ‚â• g}1 t ‚â§ tÃÉ P (G = g|G ‚â§ t)
P
P
O
wW
(g, t) = 1{t ‚â• g}P (G = g|G ‚â§ T )/ g‚ààG Tt=2 1{t ‚â• g}P (G = g|G ‚â§ T )
O
wsel
(g, t) = 1{t ‚â• g}P (G = g|G ‚â§ T )/ (T ‚àí g + 1)

Notes: This table provides expressions for the weights on each AT T (g, t) (as in Equation 3.1) for each
parameter discussed in this section. In all cases except for Œ∏ccumu (tÃÉ), the weights are all non-negative and sum to
one. For Œ∏ccumu (tÃÉ), the
 weights are all non-negative but sum up to tÃÉ ‚àí 1 (rather than one), but this is just a
reflection of Œ∏ccumu tÃÉ being a cumulative treatment effect measure.

with the event study regression in (3.3).
Let e denote event-time, i.e., e = t ‚àí g denotes the time elapsed since treatment was adopted. Recall
that G denotes the time period that a unit is first treated. Thus, a way to aggregate the AT T (g, t)‚Äôs to
highlight treatment effect heterogeneity with respect to e is
Œ∏es (e) =

X

1{g + e ‚â§ T }P (G = g|G + e ‚â§ T )AT T (g, g + e).

(3.4)

g‚ààG

This is the average effect of participating in the treatment e time periods after the treatment was adopted
across all groups that are ever observed to have participated in the treatment for exactly e time periods.
Here, the ‚Äúon impact‚Äù average effect of participating in the treatment occurs for e = 0. Œ∏es (e) is the
natural target for event study regressions that are common in applied work, though it completely avoids
the pitfalls associated with the dynamic TWFE specification in (3.3).10
In event study regressions, it is common to plot Œ≤e across different values of e and to interpret
differences as being due to treatment effect dynamics. Similarly, one can plot Œ∏es (e) across different
e‚Äôs to better understand treatment effect dynamics. When doing so, it is important to be aware that
these comparisons may include compositional changes that can complicate the interpretation of these
parameters (note that the same complications arise for event study regressions as well). To see this, for

10

Many of the parameters in this section involve expressions that have similar components as the one for Œ∏es (e) in (3.4),
and it is worth mentioning a few extra details for this case that are common to the other expressions below. The term
involving the indicator function, 1{g + e ‚â§ T }, limits consideration to identified group-time average treatment effects. The
summation over groups with group specific weights, in this case given by P (G = g|G + e ‚â§ T ), calculates an average,
weighted by group size, of AT T (g, t)‚Äôs that are involved in a particular aggregation. In addition, it is straightforward to
show that Œ∏es (e) can be written in the form of Œ∏ in Equation (3.1). Throughout this section, we have written each parameter
of interest in its most intuitive form. Weights for each parameter in this section corresponding to the form of the weights in
Equation (3.1) are provided in Table 1.

15

0 ‚â§ e1 < e2 ‚â§ T ‚àí 2, consider the difference between Œ∏es (e2 ) and Œ∏es (e1 ) which is given by
Œ∏es (e2 ) ‚àí Œ∏es (e1 ) =

X
g‚ààG

1{g + e1 ‚â§ T }P (G = g|G + e1 ‚â§ T )(AT T (g, g + e2 ) ‚àí AT T (g, g + e1 ))
|
{z
}

+

X

‚àí

X

g‚ààG

g‚ààG

(3.5)

dynamic effect for group g

1{g + e2 ‚â§ T }(P (G = g|G + e2 ‚â§ T ) ‚àí P (G = g|G + e1 ‚â§ T ))AT T (g, g + e2 )
|
{z
}
differences in weights

1{T ‚àí e2 < g ‚â§ T ‚àí e1 }P (G = g|G + e1 ‚â§ T )AT T (g, g + e2 ).
|
{z
}
different composition of groups

From the above decomposition it becomes clear that comparing Œ∏es (e) at two different values of e provides
a weighted average of the dynamic effect of participating in the treatment ‚Äì the first component on the
right-hand side of (3.5) ‚Äì plus two extra undesirable terms. Both of these undesirable terms are due
to different compositions of groups at different event times.11 The first term arises because the weights
at each length of exposure differ due to the changing composition of groups at each event time. The
second term comes directly from different compositions of groups at each length of exposure. These two
additional terms may prevent one from interpreting the differences in Œ∏es (e) across different values of e
as being actual dynamic effects of participating in the treatment unless one is willing to impose that
AT T (g, g + e) does not vary with g for any e ‚â• 0; i.e., that dynamic effects are common across groups.12
However, this sort of homogeneity condition may be deemed too strong in many applications.
A simple alternative causal parameter that can be used to highlight treatment effect dynamics with
respect to length of exposure to the treatment and does not suffer from the issue of compositional changes
highlighted in (3.5) arises from ‚Äúbalancing‚Äù the groups with respect to event time, i.e., to only aggregate
the AT T (g, t)‚Äôs for a fixed set of groups that are exposed to the treatment for at least some particular
number of time periods and thereby circumvent the issue of compositional changes across different values
of e. In particular, for some event time e0 with 0 ‚â§ e ‚â§ e0 ‚â§ T ‚àí 2, let
bal
Œ∏es
(e; e0 ) =

X

1{g + e0 ‚â§ T }AT T (g, g + e)P (G = g|G + e0 ‚â§ T ).

(3.6)

g‚ààG
bal (e; e0 ) is very similar to Œ∏ (e) except that it calculates the average groupNotice that the definition of Œ∏es
es

time average treatment effect for units whose event time is equal to e and who are observed to participate
in the treatment for at least e0 periods. In this case, since the composition of groups is the same across
bal (e; e0 ) across
all values of e, the additional terms in (3.5) do not show up at all and differences in Œ∏es

different values of e cannot be due to differences in the composition of groups at different values of e. As
an example, when one is interested in analyzing the evolution of treatment effects up to 5 periods after
treatment was implemented, one can set e0 = 5 and, this way, the same groups of units will be used when
bal (0; 5), Œ∏ bal (1; 5), . . . , Œ∏ bal (5; 5).
computing Œ∏es
es
es

The price one pays for ‚Äúbalancing‚Äù the groups with respect to event time is that fewer groups are
used to compute these event-study-type estimands, which can lead to less informative inference. Thus, in
11

The composition changes mentioned here arise due to the staggered adoption of the treatment. For example, when
T = 3, groups 2 and 3 both show up in the expression for Œ∏es (0), but only group 2 shows up in the expression for Œ∏es (1).
12
If AT T (g, g + e) does not vary with g for any e ‚â• 0, it is straightforward to show that the last two terms of (3.5) sum
up to 0.

16

bal
practice, one should consider this ‚Äúrobustness‚Äù versus ‚Äúefficiency‚Äù trade-off when choosing between Œ∏es

and Œ∏es .
bal (e; e0 ) closely resembles the empirical practice of only reporting event-studyRemark 8. We note that Œ∏es

type coefficients for the event periods that do not suffer from compositional changes, see, e.g., McCrary
(2007) and Bailey and Goodman-Bacon (2015). An important caveat is that our proposed event-study-type
bal (e; e0 ) are not based on dynamic TWFE specifications akin to (3.3), and therefore bypass
estimands Œ∏es

the pitfalls associated with (3.3) highlighted by Sun and Abraham (2020).
3.1.2

How do average treatment effects vary across groups?

It is also straightforward to aggregate our group-time average treatment effects to understand heterogeneity in the effect of participating in the treatment across groups. Although understanding this sort
of heterogeneity is relatively less common in applied work than trying to understand dynamic effects as
discussed above, there are still a number of cases in economics where understanding this sort of heterogeneity may be of interest. For example, work on the effect of graduating during a recession on labor
market outcomes (Oreopoulos et al. (2012)) or the effect of job displacement across the business cycle
(Farber (2017)) are related to heterogeneous effects across groups. More generally, these parameters are
useful for understanding if the effect of participating in the treatment was larger for groups that are
treated earlier relative to groups that are treated later. In addition, in the next section, these parameters
will be the building block for our main measure of the overall effect of participating in the treatment. To
consider heterogeneous effects across groups, we consider the following parameter
T

Œ∏sel (gÃÉ) =

X
1
AT T (gÃÉ, t).
T ‚àí gÃÉ + 1

(3.7)

t=gÃÉ

Œ∏sel (gÃÉ) is the average effect of participating in the treatment among units in group gÃÉ, across all their
post-treatment periods.
3.1.3

What is the cumulative average treatment effect of the policy across all groups until
time tÃÉ?

In some applications, researchers may want to construct an aggregated target parameter to highlight
treatment effect heterogeneity with respect to calendar time. In economics, for example, researchers
might wish to study heterogeneous treatment effects across the business cycle. The average effect of
participating in the treatment in time period t (across groups that have adopted the treatment by period
t) is given by
Œ∏c (tÃÉ) =

X

1{tÃÉ ‚â• g}P (G = g|G ‚â§ tÃÉ)AT T (g, t)

(3.8)

g‚ààG

An extension to this parameter is to think about the cumulative effect of participating in the treatment
up to some particular time period. For instance, in active labor market applications, policy makers may
want to know the cumulative average effect of a given training program on earnings from the year that
the first group of people were trained until year tÃÉ. This would provide a measure of the cumulative

17

earnings gains induced by the training program. Alternatively, in health applications, researchers may
want to measure how many COVID-19 cases have been averted by shelter-in-place orders up to day tÃÉ.
To consider the cumulative effect, consider the following parameter
Œ∏ccumu



tÃÉ =

tÃÉ
X

Œ∏c (t).

(3.9)

t=2


Œ∏ccumu tÃÉ can be interpreted as the cumulative average treatment effect among the units that have been
treated by time tÃÉ.

3.2

Aggregations into Overall Treatment Effect Parameters

Finally in this section, we consider some ideas for aggregating group time average treatment effects into
an overall effect of participating in the treatment. One very simple idea is to just average all of the
identified group-time average treatment effects together; i.e., to consider the parameter
T

O
Œ∏W
=

1 XX
1{t ‚â• g}AT T (g, t)P (G = g|G ‚â§ T )
Œ∫

(3.10)

g‚ààG t=2

P

PT

t=2 1{t ‚â• g}P (G = g|G ‚â§ T ) (which ensures that the weights on AT T (g, t) in the secO is a weighted average of each AT T (g, t) putting more weight on AT T (g, t)‚Äôs
ond term sum up to one). Œ∏W

where Œ∫ =

g‚ààG

with larger group sizes. Unlike Œ≤ in the TWFE regression specification (3.2), this simple combination of
AT T (g, t)‚Äôs immediately rules out troubling issues due to negative weights; as a particular example, when
the effect of participating in the treatment is positive for all units, this aggregated parameter cannot be
negative.
That being said, just requiring positive weights is a very minimal requirement of a reasonable overall
O is that it systematically puts more weight
treatment effect parameter. For example, one drawback of Œ∏W

on groups that participate in the treatment for longer. Instead, we suggest the following parameter as a
general-purpose summary of the average effect of participating in the treatment
O
Œ∏sel
=

X

Œ∏sel (g)P (G = g|G ‚â§ T )

(3.11)

g‚ààG

where Œ∏sel (g) is the average effect of participating in the treatment for units in group g as defined in
O first computes the average effect for each group (across all time periods) and
Equation (3.7) above. Œ∏sel

then averages these effects together across groups to summarize the overall average effect of participating
O is the average effect of participating in the treatment experienced by all
in the treatment. Thus, Œ∏sel

units that ever participated in the treatment. In this respect, its interpretation is the same as the ATT in
the canonical DiD setup with two periods and two groups. This is an attractive property for a summary
measure of the overall effect of participating in the treatment in the context of multiple time periods and
variation in treatment timing.
Working by analogy, one can also define overall treatment effect parameters by averaging Œ∏es (e) across

18

all event times or Œ∏c (t) across all time periods, i.e.,
T ‚àí2

O
Œ∏es
=

T

1 X
Œ∏es (e)
T ‚àí1

Œ∏cO =

e=0

1 X
Œ∏c (t)
T ‚àí1

(3.12)

t=2

O
In our view, the appeal of these aggregations is likely to be somewhat more limited than that of Œ∏sel
O is complicated by the issue of the changing
in most applications. For example, the interpretation of Œ∏es

composition of groups across different values of e discussed above (similar arguments apply to Œ∏cO as well).
As before, one can circumvent the issue of the changing composition of groups by balancing the sample
with respect to event time. A (local) single summary parameter is given by
e0

O,bal 0
Œ∏es
(e ) =

1 X bal
Œ∏es (e, e0 )
e0 + 1

(3.13)

e=0

This is the average effect of participating in the treatment over the first e0 periods of exposure to the
treatment. This is also a reasonable alternative overall treatment effect parameter, but it should also be
noted that it is local to groups that participated in the treatment for at least e0 periods.
As a final comment, in general, none of the overall effect parameters considered in this section are
equal to each other except in the special case where AT T (g, t) is the same for all groups and all time
periods. In that case, all of the aggregated parameters, including Œ≤ from the TWFE regression, are equal
to each other.

4

Estimation and Inference

So far we have focused on the identification and aggregation stages of the analysis. In this section,
we show how one can build on these results to form estimators for and conduct inference about the
group-time average treatment effects and their summary measures described in Section 3. Given that the
AT T (g, t)‚Äôs are the main building blocks of our analysis, we start with them.
First, it is important to notice that our identification results in Theorem 1 are constructive and
suggest a simple and intuitive two-step estimation strategy to estimate the AT T (g, t)‚Äôs. In the first step,
one estimates the nuisance functions for each group g and time period t ‚Äî pg (x) and/or mnev
g,t,Œ¥ (X) if
one relies on Assumption 4, and pg,t+Œ¥ (x) and/or mny
g,t,Œ¥ (X) if one relies on Assumption 5. In the second
step, one plugs the fitted values of these estimated nuisance functions into the sample analogue of the
considered AT T (g, t) estimand to obtain estimates of the group-time average treatment effect.
A natural question that then arises is which type of approach one should use in practice: the outcome regression, inverse probability weighting, or the doubly-robust one. Although these three different approaches are equivalent from the identification perspective, this is not the case from the estimation/inference perspective. The OR approach requires researchers to correctly model the outcome
evolution of the comparison group to estimate the group-time average treatment effects. This approach
is explicitly connected with the conditional parallel trends assumption required in DiD analysis as this
condition is usually expressed in terms of conditional expectations. The IPW approach, on the other
hand, avoids explicitly modeling the outcome evolution of the comparison group and therefore does not

19

rely on putative model restrictions directly tied to the parameter of interest. Instead, the IPW approach
requires one to correctly model the conditional probability of unit i being in group g given their covariates X and that they are either in group g or in an appropriate comparison group. The DR approach
combines both the OR and IPW approaches as it relies on modeling both the outcome evolution and the
propensity score. However, it only requires one to correctly specify either (but not necessarily both) the
outcome evolution for the comparison group or the propensity score model (Sant‚ÄôAnna and Zhao, 2020).
Thus, the DR approach enjoys additional robustness against model misspecifications when compared to
the OR and IPW approaches. In addition, the DR approach potentially allows one to use a broader set
of estimation methods such as those that involve penalization and some types of model selection, see, e.g.
Belloni et al. (2017).
Given these attractive robustness features associated with the DR approach, in this section we consider
estimators of the DR form; the discussion on how to proceed with the OR and IPW approaches is
analogous and therefore omitted. We also focus on parametric estimators for the nuisance functions. We
consider this case mainly for its practical appeal which is especially true in applications where the number
of covariates is fairly large and the number of observations is only moderate.13
More concisely, let

nev

i


bnev
,
X;
Œ≤
b nev
w
bgtreat ‚àí w
bgcomp,nev Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí m
g,t,Œ¥
g,t,Œ¥
h


i

ny
bny
[
AT
T dr (g, t; Œ¥) = En w
bgtreat ‚àí w
bgcomp,ny Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí m
b ny
,
g,t,Œ¥ X; Œ≤g,t,Œ¥

[
AT
T dr (g, t; Œ¥) = En

h

(4.1)
(4.2)

where
pbg (X; œÄ
bg ) C
pbg,t+Œ¥ (X; œÄ
bg,t+Œ¥ ) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
Gg
1 ‚àí pbg (X; œÄ
bg )
1 ‚àí pbg,t+Œ¥ (X; œÄ
bg,t+Œ¥ )
, w
,


w
bgtreat =
, w
bgcomp,nev =
bgcomp,ny =
pbg (X; œÄ
bg ) C
pbg,t+Œ¥ (X; œÄ
bg,t+Œ¥ ) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
En [Gg ]
En
En
1 ‚àí pbg (X; œÄ
bg )
1 ‚àí pbg,t+Œ¥ (X; œÄ
bg,t+Œ¥ )

bny
bnev
b ny
with pbg (¬∑; œÄ
bg ), pbg,t+Œ¥ (¬∑; œÄ
bg,t+Œ¥ ), m
b nev
g,t,Œ¥ (¬∑; Œ≤g,t,Œ¥ ) and m
g,t,Œ¥ (¬∑; Œ≤g,t,Œ¥ ) being (parametric) estimators of pg (¬∑),
nev
P
[
T dr (g, t; Œ¥)
pg,t+Œ¥ (¬∑), mnev (¬∑) and mny (¬∑), respectively, and for a generic Z, En [Z] = n‚àí1 n Zi . AT
g,t,Œ¥
nev

i=1

g,t,Œ¥

[
and AT
T dr (g, t; Œ¥) are our proposed DR DiD estimators for AT T (g, t) when one invokes Assumption
4 and Assumption 5, respectively. These estimators extend the DR DiD estimators of Sant‚ÄôAnna and
Zhao (2020) from the two periods, two groups setup to the multiple groups, multiple periods setup while
allowing for possible treatment anticipation. In addition, these estimators are of the HaÃÅjek (1971)-type
and their associated weights are guaranteed to sum up to one in finite samples. As illustrated by Busso
et al. (2014), this usually leads to improved finite sample properties.
With the estimators for the AT T (g, t)‚Äôs in hand, one can use the analogy principle and combine these
13

Alternatively, one could adopt a fully nonparametric approach. Let f (x) be a generic notation for the nuisance
functions. From Newey (1994), Chen et al. (2003), Ai and Chen (2003, 2007, 2012), and Chen et al. (2008), onecan see

that the use of nonparametric first-step estimators gb (x) of g (x) is warranted provided that kb
g (x) ‚àí g (x)kH = op n‚àí1/4

for a pseudo-metric k¬∑kH , H being a vector space of functions. However, when the dimension
 of X is moderate or large, as
is often the case in empirical applications, conditions ensuring that kb
g (x) ‚àí g (x)kH = op n‚àí1/4 can be rather stringent
due to the so-called ‚Äúcurse of dimensionality‚Äù.

20

to estimate the summarized average treatment effect parameters discussed in Section 3.
Remark 9. In applications with limited covariate overlap (i.e., with propensity scores sufficiently close
to one), IPW and DR estimators may lead to imprecise (irregular) inference procedures, see, e.g., Khan
and Tamer (2010). In such cases, provided that one is comfortable with (parametric) extrapolation and
is sufficiently confident that the outcome regression working models are correctly specified, relying on the
OR estimation approach may lead to more informative inferences. Alternatively, one may choose to trim
extreme propensity score estimates though proceeding in this manner would change the target parameter;
i.e., we would not be recovering the AT T (g, t)‚Äôs; see, e.g., Crump et al. (2009) and Yang and Ding (2018)
for related discussion in other contexts. In the rest of the paper, we abstract from these points.

4.1

Asymptotic Theory for Group-Time Average Treatment Effects

Next, we derive the asymptotic properties of our DR DiD estimators for the AT T (g, t)‚Äôs. To simplify
exposition, we focus on the case with a never-treated comparison group as in (4.1); results that come from
using the not-yet-treated group as the comparison group as in (4.2) follow from symmetric arguments
and are therefore omitted. We also note that the theoretical results in this section are justified within
the large n, fixed T paradigm.
p
Let kZk = trace (Z 0 Z) denote the Euclidean norm of Z and set W = (Y1 , . . . , YT , X, D1 , . . . , DT ).
0

nev
0
For a generic Œ∫nev
g,t = œÄg , Œ≤g,t,Œ¥ , let



nev
treat
,
hdr,nev
W ; Œ∫nev
(W ) ‚àí wgcomp,nev (W ; œÄg ) Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
g,t , Œ¥ = wg
g,t,Œ¥ X; Œ≤g,t,Œ¥
g,t
where the normalized weights wgtreat (W ) and wgcomp,nev (W ; œÄg ) are given by
wgtreat (W ) =

Gg
,
E [Gg ]

wgcomp,nev (W ; œÄg ) =

pg (X; œÄg ) C
1 ‚àí pg (X; œÄg )






pg (X; œÄg ) C
E
.
1 ‚àí pg (X; œÄg )

(4.3)

(¬∑). With some abuse of notation, let g (¬∑; Œ≥) be a
Let g (¬∑) be a generic notation for pg (¬∑) and mnev
g,t,Œ¥


nev
nev
generic notation for pg (¬∑; œÄg ) and mg,t,Œ¥ ¬∑; Œ≤g,t,Œ¥ . The vector of pseudo-true parameters is given by

0

. nev
‚àó,nev
‚àó,nev 0
nev = ‚àÇ hdr,nev W ; Œ∫nev
Œ∫g,t
= œÄg‚àó0 , Œ≤g,t,Œ¥
. Finally, let hÃádr,nev
W
;
Œ∫
‚àÇŒ∫g,t .
g,t
g,t
g,t
g,t
Assumption 7. (i) g (x; Œ≥) is a parametric model for g (x), where Œ≥ ‚àà Œò ‚äÇ Rk , Œò being compact; (ii)
g (X; Œ≥) is a.s. continuous at each Œ≥ ‚àà Œò; (iii) there exists a unique pseudo-true parameter Œ≥ ‚àó ‚àà int (Œò);
(iv) g (X; Œ≥) is a.s. twice continuously differentiable in a neighborhood of Œ≥ ‚àó , Œò‚àó ‚äÇ Œò; (v) the estimator
Œ≥
b is strongly consistent for Œ≥ ‚àó and satisfies the following linear expansion:
‚àö

n

1 X
n (b
Œ≥‚àíŒ≥ )= ‚àö
lg,t (Wi ; Œ≥ ‚àó ) + op (1) ,
n
‚àó

i=1



‚àó
‚àó 0
‚àó
where lg,t (¬∑; Œ≥) is a k √ó 1 vector
h such that E [lg,t (W ; Œ≥ )] = 0, E lg,t (W
i ; Œ≥ ) lg,t (W ; Œ≥ ) exists and is

positive definite and lims‚Üí0 E supŒ≥‚ààŒò‚àó :kŒ≥‚àíŒ≥ ‚àó k‚â§s klg (W ; Œ≥) ‚àí lg (W ; Œ≥ ‚àó )k2 = 0. In addition, (vi) for some
Œµ > 0 and all g ‚àà G, 0 ‚â§ pg (X; œÄg ) ‚â§ 1 ‚àí Œµ a.s., for all œÄ ‚àà int (Œòps ), where Œòps denotes the parameter
space of œÄg .

21

h
i
‚àó,nev  2
Assumption 8. For each g ‚àà G and t = {2, . . . , T ‚àí Œ¥}, assume that E hnev
W
;
Œ∫
,
Œ¥
< ‚àû
g,t
g,t
h
i
‚àó,nev
‚àó
and E supŒ∫‚ààŒì‚àó hÃánev
g,t (W ; Œ∫) < ‚àû, where Œì is a small neighborhood of Œ∫g,t .
Assumptions 7-8 are standard in the literature, see e.g. Abadie (2005), Wooldridge (2007), Bonhomme
and Sauder (2011), Graham et al. (2012), and Sant‚ÄôAnna and Zhao (2020). Assumption 7 requires that the
‚àö
first-step estimators are based on smooth parametric models and that the estimated parameters admit nasymptotically linear representations, whereas Assumption 8 imposes some weak integrability conditions.
Under mild moment conditions, these requirements are fulfilled when one adopts linear/nonlinear outcome
regressions or logit/probit models, for example, and estimates the unknown parameters by (nonlinear)
least squares, quasi-maximum likelihood, or other alternative estimation methods, see e.g. Chapter 5 in
van der Vaart (1998), Wooldridge (2007), Graham et al. (2012) and Sant‚ÄôAnna and Zhao (2020). In
other words, Assumptions 7-8 allow for flexible parametric specifications of the nuisance functions and
accommodate different estimation methods.


nev
In what follows, we write wgtreat = wgtreat (W ), wgcomp (œÄg ) = wgcomp,nev (W ; œÄg ), and mnev
g,t,Œ¥ Œ≤g,t,Œ¥ =



0
nev
nev = œÄ 0 , Œ≤ nev 0 , define
mnev
X;
Œ≤
to
minimize
notation.
For
a
generic
Œ∫
g,t
g g,t,Œ¥
g,t,Œ¥
g,t,Œ¥
est,nev
comp,nev
treat,nev
dr,nev
nev
nev
nev
),
(Wi ; œÄg , Œ≤g,t,Œ¥
) ‚àí œàg,t,Œ¥
(Wi ; œÄg , Œ≤g,t,Œ¥
) ‚àí œàg,t,Œ¥
(Wi ; Œ≤g,t,Œ¥
(Wi ; Œ∫nev
œàg,t,Œ¥
g,t ) = œàg,t,Œ¥

(4.4)

with

treat,nev
nev
nev
) = wgtreat ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
(W ; Œ≤g,t,Œ¥
œàg,t,Œ¥
g,t,Œ¥ Œ≤g,t,Œ¥


nev
,
‚àí wgtreat ¬∑ E wgtreat ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
g,t,Œ¥ Œ≤g,t,Œ¥

comp,nev
nev
nev
) = wgcomp (œÄg ) ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
(W ; œÄg , Œ≤g,t,Œ¥
œàg,t,Œ¥
g,t,Œ¥ Œ≤g,t,Œ¥


nev
,
‚àí wgcomp (œÄg ) ¬∑ E wgcomp (œÄg ) ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
g,t,Œ¥ Œ≤g,t,Œ¥
and
or,nev
est,nev
nev
nev
) = lg,t
Œ≤g,t,Œ¥
œàg,t
(W ; œÄg , Œ≤g,t,Œ¥

0

dr,nev,2
dr,nev,1
,
+ lgps,nev (œÄg )0 ¬∑ Mg,t,Œ¥
¬∑ Mg,t,Œ¥

or,nev
where lg,t
(¬∑) is the asymptotic linear representation of the estimator for the outcome evolution of the

comparison groups as described in Assumption 7(iv), lgps,nev (¬∑) is defined analogously for the generalized
propensity score, and
dr,nev,1
Mg,t,Œ¥
=E





nev
wgtreat ‚àí wgcomp (œÄg ) ¬∑ mÃánev
,
g,t,Œ¥ Œ≤g,t,Œ¥




dr,nev,2
nev
Mg,t,Œ¥
= E Œ±gps,nev (œÄg ) ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
¬∑ pÃág (œÄg )
g,t,Œ¥ Œ≤g,t,Œ¥



nev
‚àí E Œ±gps,nev (œÄg ) ¬∑ wgcomp (œÄg ) ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
¬∑ pÃág (œÄg ) ,
g,t,Œ¥ Œ≤g,t,Œ¥



.
nev
nev X; Œ≤ nev
nev , pÃá (œÄ ) = ‚àÇp (X; œÄ )/ ‚àÇœÄ , and
with mÃánev
Œ≤
=
‚àÇm
‚àÇŒ≤g,t,Œ¥
g
g
g
g
g
g,t,Œ¥
g,t,Œ¥
g,t,Œ¥
g,t,Œ¥
Œ±gps,nev (œÄg ) =

C
(1 ‚àí pg (X; œÄg ))2

dr,nev

, 

pg (X; œÄg ) C
E
.
1 ‚àí pg (X; œÄg )
nev

[
[
Finally, let AT Tt‚â•(g‚àíŒ¥) and AT
T t‚â•(g‚àíŒ¥) denote the vector of AT T (g, t) and AT
T dr (g, t; Œ¥), respec22

tively, for all g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥} such that t ‚â• g ‚àí Œ¥. Analogously, let Œ®dr,nev
t‚â•(g‚àíŒ¥) denote the collection
dr,nev
of œàg,t,Œ¥
across all g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥} such that t ‚â• g ‚àí Œ¥. Consider the following claim:

For each g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥} such that t ‚â• g ‚àí Œ¥,

‚àÉœÄg‚àó ‚àà Œòps : P pg (X; œÄg‚àó ) = pg (X) = 1 or




‚àó,nev
‚àó,nev
nev
= 1.
‚àÉŒ≤g,t,Œ¥
‚àà Œòreg : P mnev
X;
Œ≤
=
m
(X)
g,t,Œ¥
g,t,Œ¥
g,t,Œ¥

(4.5)

Claim (4.5) says that either the working parametric model for the generalized propensity score is correctly
specified, or the working outcome regression model for the comparison group is correctly specified.
dr,nev
[
The next theorem establishes the joint limiting distribution of AT
T t‚â•(g‚àíŒ¥) .
Theorem 2. Under Assumptions 1-4, 6-8, for each g and t such that g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥} and
t ‚â• g ‚àí Œ¥, provided that (4.5) is true,
‚àö

n

nev
1 X dr,nev
[
n(AT
T dr (g, t; Œ¥) ‚àí AT T (g, t)) = ‚àö
œàg,t,Œ¥ (Wi ; Œ∫‚àó,nev
g,t ) + op (1).
n
i=1

Furthermore, as n ‚Üí ‚àû,

‚àö

dr,nev

d

[
n(AT
T t‚â•(g‚àíŒ¥) ‚àí AT Tt‚â•(g‚àíŒ¥) ) ‚àí
‚Üí N (0, Œ£)

dr,nev
0
where Œ£ = E[Œ®dr,nev
t‚â•(g‚àíŒ¥) (W )Œ®t‚â•(g‚àíŒ¥) (W ) ].

Theorem 2 provides the influence function for estimating the vector of group-time average treatment
effects, AT Tt‚â•(g‚àíŒ¥) , as well as its limiting distribution. Importantly, Theorem 2 emphasizes the DR
nev
[
property of AT
T dr (g, t; Œ¥): it recovers the AT T (g, t) provided that either the propensity score working
model or outcome regression working model for the ‚Äúnever treated‚Äù is correctly specified.
In order to conduct inference, one can show that the sample analogue of Œ£ is a consistent estimator
for Œ£, which leads directly to standard errors and pointwise confidence intervals. Instead of following this
route, we propose to use a simple multiplier bootstrap procedure to conduct asymptotically valid inference.
Our proposed bootstrap leverages the asymptotic linear representations derived in Theorem 2 and inherits
important advantages. First, it is easy to implement and very fast to compute. Each bootstrap iteration
simply amounts to ‚Äúperturbing‚Äù the influence function by a random weight V , and it does not require
re-estimating the propensity score in each bootstrap draw. Second, in each bootstrap iteration, there are
always observations from each group. This can be a real problem with the traditional empirical bootstrap
where there may be no observations from a particular group in some particular bootstrap iteration.
Third, computation of simultaneously (in g and t) valid confidence bands is relatively straightforward.
This is particularly important since researchers are likely to use confidence bands to visualize estimation
uncertainty about AT T (g, t) . Unlike pointwise confidence bands, simultaneous confidences bands do not
suffer from multiple-testing problems and are guaranteed to cover all AT T (g, t)‚Äôs with a probability at
least 1 ‚àí Œ±. Finally, we note that our proposed bootstrap procedure can be readily modified to account
for clustering, see Remark 10 below.
b dr,nev (W ) denote the sample-analogue of Œ®dr,nev (W ), where population expecTo proceed, let Œ®
t‚â•(g‚àíŒ¥)
t‚â•(g‚àíŒ¥)
tations are replaced by their empirical analogue, and the true nuisance functions and their derivatives
are replaced by their estimators. Let {Vi }ni=1 be a sequence of iid random variables with zero mean,
23

unit variance, and finite third moment, independent of the original sample {Wi }ni=1 . A popular exam‚àö
‚àö
ple involves iid Bernoulli variates {Vi } with P (V = 1 ‚àí Œ∫) = Œ∫/ 5 and P (V = Œ∫) = 1 ‚àí Œ∫/ 5, where
‚àö

Œ∫=
5 + 1 /2, as suggested by Mammen (1993).
‚àó,dr,nev
dr,nev
[
[
We define AT
T t‚â•(g‚àíŒ¥) , a bootstrap draw of AT
T t‚â•(g‚àíŒ¥) , via
h
i
‚àó,dr,nev
dr,nev
b dr,nev (W ) .
[
[
AT
T t‚â•(g‚àíŒ¥) = AT
T t‚â•(g‚àíŒ¥) + En V ¬∑ Œ®
t‚â•(g‚àíŒ¥)

(4.6)

The next theorem establishes the asymptotic validity of the multiplier bootstrap procedure proposed
above.
Theorem 3. Under the assumptions of Theorem 2


‚àö
‚àó,dr,nev
dr,nev
d
[
[
n AT T t‚â•(g‚àíŒ¥) ‚àí AT T t‚â•(g‚àíŒ¥) ‚Üí N (0, Œ£),
‚àó

d

where Œ£ is as in Theorem 2, and ‚Üí denotes weak convergence (convergence in distribution) of the bootstrap
‚àó

law in probability, i.e., conditional on the original sample {Wi }ni=1 . Additionally, for any continuous
functional Œì(¬∑),14

Œì

‚àö



‚àó,dr,nev
dr,nev
d
[
[
n AT
T t‚â•(g‚àíŒ¥) ‚àí AT
T t‚â•(g‚àíŒ¥)
‚Üí Œì (N (0, Œ£)) .
‚àó

We now describe a practical bootstrap algorithm to compute studentized confidence bands that cover
AT T (g, t) simultaneously over all t ‚â• g ‚àí Œ¥ with a pre-specified probability 1 ‚àí Œ± in large samples.
This is similar to the bootstrap procedures used in Kline and Santos (2012), Belloni et al. (2017) and
Chernozhukov et al. (2018) in different contexts.
‚àó,dr,nev

[
Algorithm 1. 1) Draw a realization of {Vi }ni=1 . 2) Compute AT
T t‚â•(g‚àíŒ¥) as in (4.6), denote its (g, t)‚àó
[
element as AT
T (g, t) , and form a bootstrap draw of its limiting distribution as
RÃÇ‚àó (g, t) =


‚àö 
‚àó
[
[
n AT
T (g, t) ‚àí AT
T (g, t) .

3) Repeat steps 1-2 B times. 4) Compute a bootstrap estimator of the main diagonal of Œ£1/2 such as
the bootstrap interquartile range normalized by the interquartile range of the standard normal distribub 1/2 (g, t) = (q0.75 (g, t) ‚àí q0.25 (g, t)) / (z0.75 ‚àí z0.25 ) , where qp (g, t) is the pth sample quantile of the
tion, Œ£
RÃÇ‚àó (g, t) in the B draws, and zp is the pth quantile of the standard normal distribution. 5) For each bootb (g, t)‚àí1/2 . 5) Construct b
c1‚àíŒ± as the empirical
strap draw, compute t‚àítestt‚â•(g‚àíŒ¥) = max(g,t) RÃÇ‚àó (g, t) Œ£
(1 ‚àí a)-quantile of the B bootstrap draws of t‚àítestt‚â•(g‚àíŒ¥) . 6) Construct the bootstrapped simultaneous
nev
b (g, t) = [AT
b (g, t)‚àí1/2 /‚àön].
[
confidence band for AT T (g, t), t ‚â• (g ‚àí Œ¥) , as C
T dr (g, t; Œ¥) ¬± b
c1‚àíŒ± Œ£
The next corollary to Theorem 3 states that the simultaneous confidence band for AT T (g, t) described
in Algorithm 1 has correct asymptotic coverage.
Corollary 1. Under the assumptions of Theorem 2, for any 0 < Œ± < 1, as n ‚Üí ‚àû,


b (g, t) ‚àÄt ‚àà {2, . . . , T } , g ‚àà GŒ¥ : t ‚â• g ‚àí Œ¥ ‚Üí 1 ‚àí Œ±,
P AT T (g, t) ‚àà C
14

Since the number of periods T is fixed, Œì(¬∑) should be interpreted as a continuous functional between Euclidean spaces.

24

b (g, t) is as defined in Algorithm 1.
where C
Remark 10. In DiD applications, it is common to use ‚Äúcluster-robust‚Äù inference procedures; see, e.g.,
Wooldridge (2003) and Bertrand et al. (2004). However, we note that the choice of whether to cluster
or not is usually not obvious, and depends on the kind of uncertainty one is trying to reflect; see, e.g.,
Abadie et al. (2017) for a discussion in a cross-sectional setup.15 In the case that one wishes to account
for clustering to reflect ‚Äúcluster-based‚Äù sampling uncertainty, we note that this can be done in a straightforward manner using a small modification of the multiplier bootstrap described above, provided that the
number of cluster is ‚Äúlarge.‚Äù More precisely, instead of drawing observation-specific V ‚Äôs, one simply needs
to draw cluster-specific V ‚Äôs; see, e.g., Sherman and Le Cessie (2007), Kline and Santos (2012), Cheng
et al. (2013), and MacKinnon and Webb (2018, 2020). If the number of clusters is ‚Äúsmall,‚Äù however,
the application of the aforementioned bootstrap procedure is not warranted.16
Remark 11. In Algorithm 1 we have required an estimator for the main diagonal of Œ£. However, we
b (g, t) = 1 for all (g, t), the result in Corollary 1 continues to hold. However, the
note that if one takes Œ£
resulting ‚Äúconstant width‚Äù simultaneous confidence band may be of larger length; see, e.g., Montiel Olea
and Plagborg-M√∏ller (2018) and Freyberger and Rai (2018).
Remark 12. The above results focus on making inference about AT T (g, t)‚Äôs in (effective) post-treatment
periods t ‚â• g ‚àí Œ¥. Although the limited anticipation condition in Assumption 3 implies that AT T (g, t) = 0
for all t < g ‚àí Œ¥ regardless of the group g, it is common practice to also estimate these pre-treatment
parameters and use them to assess the credibility of the underlying identifying assumptions. Note that
our DiD estimands (2.2) - (2.7) can be easily adjusted to include these by simply replacing the ‚Äúlong
differences‚Äù (Yt ‚àí Yg‚àíŒ¥‚àí1 ) with the ‚Äúshort differences‚Äù (Yt ‚àí Yt‚àí1 ) for all t < g ‚àí Œ¥. All our results
dr,nev
[
continues to hold when one augments AT
T t‚â•(g‚àíŒ¥) to also include these estimates for the AT T (g, t)‚Äôs in
the pre-treatment periods t < g ‚àí Œ¥.

4.2

Asymptotic Theory for Summary Parameters

Assume, for simplicity, that Assumption 3 holds with Œ¥ = 0. In this section, we discuss how one can
estimate and make inference about the summary measures of the casual effects discussed in Section 3.
More concisely, we consider parameters of the form of Œ∏ as defined in (3.1), which covers all of the
aggregated parameters discussed in Section 3.
Given the discussion in Section 4.1, a natural way to estimate Œ∏ is to use the plug-in type estimators
Œ∏ÃÇ =

T
XX

nev

[
w
b (g, t) AT
T dr (g, t; 0) ,

g‚ààG t=2

15
The formal results in Abadie et al. (2017) focus on the cross section case and rely on additional functional form
restrictions that we do not impose in this paper. Fully extending the results of Abadie et al. (2017) to the semiparametric
panel data case is beyond the scope of our paper.
16
In such cases, provided that one is comfortable imposing additional functional form assumptions, one could use alternative procedures such as Conley and Taber (2011) and Ferman and Pinto (2019). Extending these proposals to our setup
is beyond the scope of this paper though.

25

where w
b (g, t) are estimators for w (g, t) such that for all g ‚àà G and t = 2, . . . , T ,
‚àö

n

1 X w
n (w
b (g, t) ‚àí w (g, t)) = ‚àö
Œæg,t (Wi ) + op (1) ,
n
i=1

 w

 w

w (W)0 finite and positive definite. Estimators based on the sample
with E Œægt
(W) = 0 and E Œægt
(W)Œægt
analogue of the weights discussed in Section 3 satisfy this condition.
Let
lw (Wi ) =

T 
XX


dr,nev
w
w (g, t) ¬∑ œàg,t,0
(Wi ; Œ∫‚àó,nev
)
+
Œæ
(W
)
¬∑
AT
T
(g,
t)
,
i
g,t
g,t

g‚ààG t=2
dr,nev
are as defined in (4.4).
where œàg,t,Œ¥

The following result follows immediately from Theorem 2, and can be used to conduct asymptotically
valid inference for the summary causal parameters Œ∏.
Corollary 2. Under the assumptions of Theorem 2,
‚àö

n

1 X w
n(Œ∏ÃÇ ‚àí Œ∏) = ‚àö
l (Wi ) + op (1)
n
i=1

h
i
d
‚àí
‚Üí N 0, E lw (W )2

Corollary 2 implies that one can construct standard errors andh confidence
intervals for summary
i

treatment effect parameters based on a consistent estimator of E lw (W )2 or by using a bootstrap
procedure like the one in Algorithm 1. The main advantage of using the bootstrap procedure akin
to Algorithm 1 is that inference procedures would be robust against multiple-testing problems. This

bal (e; e0 ), Œ∏ (gÃÉ), and Œ∏ tÃÉ , as practitioners would
is particularly attractive when considering Œ∏es (e), Œ∏es
c
sel
probably analyze how these parameters differ across event-times e, groups gÃÉ, and calendar-time tÃÉ.
Remark 13. As discussed in Remark 10, the validity of the ‚Äúcluster-robust‚Äù multiplier bootstrap procedure
relies on the number of clusters being ‚Äúlarge.‚Äù In some applications such a condition may be more plausible
when analyzing the aggregated parameter Œ∏ than when analyzing the AT T (g, t) themselves.

5

The Effect of Minimum Wage Policy on Teen Employment

In this section, we illustrate the empirical relevance of our proposed methods. To do this, we apply our
methods to study the effect of the minimum wage on teen employment. The main goal of this section
is to compare results arising from using a TWFE specification (as is most common in applications) to
results coming from our proposed method. We think that this comparison is important in order to get
a sense of whether the theoretical limitations of TWFE discussed in recent work end up translating into
meaningful differences in applications. Moreover, one might expect that understanding the effect of a
minimum wage change on employment is a challenging case for TWFE as the effect of the minimum wage
may be dynamic (Meer and West (2016)) and the timing of minimum wage changes varies across states.
Unlike TWFE, the approach that we have proposed in the current paper is robust to these challenges.

26

By far the most common approach to trying to understand the effect of the minimum wage on employment is to exploit variation in the timing of minimum wage increases across states. Our identification
strategy follows this approach. In particular, we consider a time period from 2001-2007 where the federal
minimum wage was flat at $5.15 per hour. We focus on county level teen employment in states whose
minimum wage was equal to the federal minimum wage at the beginning of the period. Some of these
states increased their minimum wage over this period ‚Äì these become treated groups. In particular, we
define groups by the time period when a state first increased its minimum wage. Others did not increase
their minimum wage ‚Äì these are the untreated group. This setup allows us to have more data than local
case study approaches. On the other hand, it also allows us to have cleaner identification (state-level
minimum wage policy changes) than in studies with more periods; the latter setup is more complicated
than ours particularly because of the variation in the federal minimum wage over time. It also allows
us to check for internal consistency of identifying assumptions ‚Äì namely whether or not the identifying
assumptions hold in periods before particular states raised their minimum wages.
We use county level data on teen employment and other county characteristics. County level teen
employment comes from the Quarterly Workforce Indicators (QWI), as in Dube et al. (2016); see Dube
et al. (2016) for a detailed discussion of this dataset. Other pre-treatment county characteristics come from
the 2000 County Data Book. These include county population in 2000, the fraction of the population that
is white, educational characteristics from 1990, median income in 1997, and the fraction of the population
below the poverty level in 1997. After dropping ten states due to their minimum wage being higher than
the federal minimum wage in 2000, seven other states for lack of data on teen employment, and four
other states in the Northern census region, our final sample includes county-level data from 29 states.
We provide additional details on constructing the data in the Supplementary Appendix.
Summary statistics for county characteristics are provided in Table 2. There are some notable differences in county characteristics between counties in states that increased their minimum wage and in
states that did not increase their minimum wage. Treated counties are much less likely to be in the South.
They also have much higher population (on average 94,000 compared to 53,000 for untreated counties).
The proportion of white residents is higher in treated counties (on average, 89% compared to 83% for
untreated counties). There are smaller differences in the fraction with high school degrees and the poverty
rate though the differences are both statistically significant. Treated counties have a somewhat higher
fraction of high school graduates and a somewhat lower poverty rate.

5.1

Results

In the following we discuss different sets of results using different identification strategies. In particular,
we consider the cases in which one would assume that the parallel trends assumption would hold unconditionally, and when it holds only after controlling on observed characteristics X. In the main text,
we consider the case where never-treated counties are the comparison group and where we do not allow
for any anticipation effects (i.e., Œ¥ = 0). We provide results using the not-yet-treated counties as the
comparison group and allowing for one year anticipation in the Supplementary Appendix; results from
those cases are quite similar to the ones presented here.
The first set of results comes from using the unconditional parallel trends assumption to estimate the

27

Table 2: Summary Statistics for Main Dataset

Midwest
South
West
Population (1000s)
White
HS Graduates
Poverty Rate
Median Inc. (1000s)

Treated Counties

Untreated Counties

Diff.

P-val on Diff.

0.59
0.27
0.14
94.32
0.89
0.59
0.13
33.91

0.34
0.59
0.07
53.43
0.83
0.55
0.16
31.89

0.25
-0.32
0.07
40.89
0.06
0.04
-0.03
2.02

0.00
0.00
0.00
0.00
0.00
0.00
0.00
0.00

Notes: Summary statistics for counties located in states that raised their minimum wage between Q2 of
2003 and Q1 of 2007 (treated) and states whose minimum wage was effectively set at the federal minimum
wage for the entire period (untreated). The sample consists of 2284 counties. Sources: Quarterly Workforce
Indicators and 2000 County Data Book

effect of raising the minimum wage on teen employment. The results for group-time average treatment
effects are reported in Panel (a) of Figure 1 along with a uniform 95% confidence band. All inference
procedures use clustered bootstrapped standard errors at the county level, and account for the autocorrelation of the data. The plot contains pre-treatment estimates that can be used to ‚Äúpre-test‚Äù the parallel
trends assumption as well as treatment effect estimates in post-treatment periods.
The group-time average treatment effect estimates provide support for the view that increasing the
minimum wage led to a reduction in teen employment. For 5 out of 7 group-time average treatment effects, there is a clear statistically significant negative effect on employment. The other two are marginally
insignificant (and negative). The group-time average treatment effects range from 2.3% lower teen employment to 13.6% lower teen employment. The simple average (weighted only by group size) is 5.2%
lower teen employment, and the average effect of a minimum wage increase across all groups that inO above) is 3.9% lower teen employment
creased their minimum wage (corresponding to an estimate of Œ∏sel

(see Panel (a) of Table 3). A two-way fixed effects model with a post treatment dummy variable also
provides similar results, indicating 3.7% lower teen employment due to increasing the minimum wage. In
light of the literature on the minimum wage these results are not surprising as they correspond to the
types of regressions that tend to find that increasing the minimum wage decreases employment; see the
discussion in Dube et al. (2010).
As in Meer and West (2016), there also appears to be a dynamic effect of increasing the minimum wage.
For Illinois (the only state in the group that first raised its minimum wage in 2004), teen employment
is estimated to be 3.4% lower on average in 2004 than it would have been if the minimum wage had
not been increased. In 2005, teen employment is estimated to be 7.1% lower; in 2006, 12.5% lower; and
in 2007, 13.6% lower. For states first treated in 2006, there is a small effect in 2006: 2.3% lower teen
employment; however, it is larger in 2007: 7.1% lower teen employment.
Panel (a) of Table 3 reports aggregated treatment effect measures. First, we consider how the effect
of increasing the minimum changes by the amount of time that the policy has been in place. These
parameters paint largely the same picture as the group-time average treatment effects. The effect of

28

Figure 1: Minimum Wage Group-Time Average Treatment Effects
‚óè

Pre‚àíTreatment

‚óè

Post‚àíTreatment

(a) Unconditional Parallel Trends

(b) Conditional Parallel Trends

Group 2004

Group 2004

0.2

0.2

0.1
0.0

0.1
‚óè

‚óè

0.0

‚óè

‚óè
‚óè

‚óè

‚óè
‚óè

‚óè

‚àí0.1

‚óè

‚àí0.1

‚óè

‚óè

2006

2007

‚àí0.2

‚àí0.2
2002

2003

2004

2005

2002

Group 2006

2003

2004

2005

‚óè

‚óè

2006

2007

Group 2006

0.2

0.2

0.1

0.1
‚óè

‚óè
‚óè

0.0

‚óè

0.0

‚óè

‚óè

‚óè

‚óè

‚óè
‚óè

‚àí0.1

‚àí0.1

‚àí0.2

‚àí0.2
2002

2003

2004

2005

2006

2007

2002

Group 2007

2004

‚óè

‚óè

2005

2006

2007

‚óè

‚óè

2006

2007

Group 2007

0.2

0.2

0.1
0.0

2003

0.1
‚óè

‚óè

0.0

‚óè

‚óè

‚óè

‚óè

‚àí0.1

‚óè

‚óè

‚àí0.1

‚àí0.2

‚àí0.2
2002

2003

2004

2005

2006

2007

2002

2003

2004

2005

Notes: The effect of the minimum wage on teen employment estimated under the unconditional parallel trends assumption
(Panel (a)) and the conditional parallel trends assumption (Panel (b)). Red lines give point estimates and uniform 95%
confidence bands for pre-treatment periods allowing for clustering at the county level. Under the null hypothesis of the
parallel trends assumption holding in all periods, these should be equal to 0. Blue lines provide point estimates and uniform
95% confidence bands for the treatment effect of increasing the minimum wage allowing for clustering at the county level.
The top row includes states that increased their minimum wage in 2004, the middle row includes states that increased their
minimum wage in 2006, and the bottom row includes states that increased their minimum wage in 2007. The estimates in
Panel (b) use the the doubly robust estimator discussed in the text.

increasing the minimum wage on teen employment appears to be negative and increasing in magnitude
the longer states are exposed to the higher minimum wage. In particular, in the first year that a state
increases its minimum wage, teen employment is estimated to decrease by 2.7%, in the second year it
is estimated to decrease by 7.1%, in the third year by 12.5%, and in the fourth year by 13.6%. Notice
that the last two dynamic treatment effect estimates are exactly the same as the estimates coming from
Illinois alone because Illinois is the only state that is treated for at least two years. These results are
robust to keeping the composition of groups constant by ‚Äúbalancing‚Äù the groups across different lengths
of exposure to the treatment (see the row in Table 3 labeled ‚ÄòEvent Study w/ Balanced Groups‚Äô). When
we restrict the sample to only include groups that had a minimum wage increase for at least one full
year (i.e., we keep groups 2004 and 2006 but not 2007), we estimate that the effect of increasing the
minimum wage on impact is 2.7% lower teen employment and 7.1% lower teen employment one year after

29

the increase.17
Table 3: Minimum Wage Aggregated Treatment Effect Estimates

(a) Unconditional Parallel Trends
Partially Aggregated

Single Parameters

TWFE

-0.037
(0.006)

Simple Weighted Average

-0.052
(0.006)

Group-Specific Effects
Event Study
Calendar Time Effects
Event Study
w/ Balanced Groups

g=2004
-0.091
(0.019)
e=0
-0.027
(0.006)
t=2004
-0.034
(0.019)
e=0
-0.027
(0.009)

g=2006
-0.047
(0.008)
e=1
-0.071
(0.009)
t=2005
-0.071
(0.02)
e=1
-0.071
(0.009)

g=2007
-0.028
(0.007)
e=2
-0.125
(0.021)
t=2006
-0.055
(0.009)

-0.039
(0.007)
e=3
-0.136
(0.023)
t=2007
-0.050
(0.006)

-0.090
(0.013)
-0.052
(0.013)
-0.049
(0.008)

(b) Conditional Parallel Trends
Partially Aggregated

Single Parameters

TWFE

-0.008
(0.006)

Simple Weighted Average

-0.033
(0.007)

Group-Specific Effects
Event Study
Calendar Time Effects
Event Study
w/ Balanced Groups

g=2004
-0.044
(0.020)
e=0
-0.024
(0.006)
t=2004
-0.030
(0.022)
e=0
-0.016
(0.010)

g=2006
-0.029
(0.008)
e=1
-0.041
(0.009)
t=2005
-0.025
(0.021)
e=1
-0.041
(0.009)

g=2007
-0.029
(0.008)
e=2
-0.050
(0.022)
t=2006
-0.030
(0.009)

-0.031
(0.007)
e=3
-0.071
(0.026)
t=2007
-0.049
(0.007)

-0.046
(0.013)
-0.033
(0.012)
-0.028
(0.008)

Notes: The table reports aggregated treatment effect parameters under the unconditional and conditional parallel trends
assumptions and with clustering at the county level. The row ‚ÄòTWFE‚Äô reports the coefficient on a post-treatment dummy
variable from a two-way fixed effects regression. The row ‚ÄòSimple Weighted Average‚Äô reports the weighted average (by group
size) of all available group-time average treatment effects as in Equation (3.10). The row ‚ÄòGroup-Specific Effects‚Äô summarizes
average treatment effects by the timing of the minimum wage increase; here, g indexes the year that a county is first treated. The
row ‚ÄòEvent Study‚Äô reports average treatment effects by the length of exposure to the minimum wage increase; here, e indexes the
length of exposure to the treatment. The row ‚ÄòCalendar Time Effects‚Äô reports average treatment effects by year; here, t indexes
the year. The row ‚ÄòEvent Study w/ Balanced Groups‚Äô reports average treatment effects by length of exposure using a fixed set
of groups at all lengths of exposure; here, e indexes the length of exposure and the sample consists of counties that have at least
two years of exposure to minimum wage increases. The column ‚ÄòSingle Parameters‚Äô represents a further aggregation of each type
of parameter, as discussed in the text. The estimates in Panel (b) use the the doubly robust estimator discussed in the text.

17

Notice that these estimates are exactly the same as in the first two periods for the dynamic treatment effect estimates
that do not hold the composition of groups constant across different lengths of exposure. The reason that they are the same
for initial exposure is coincidental as the results holding group composition constant do not include the group first treated
in 2007 (the estimated effect of the minimum wage in 2007 for the group of states first treated in 2007 is 2.76% lower teen
employment which just happens to correspond to the estimated effect for the balanced groups). On the other hand, for the
second period, they correspond by construction because both estimates only include the groups first treated in 2004 and
2006.

30

Our summary parameters aggregated by group and by calendar time are also consistent with the idea
that increasing the minimum wage had a negative effect on county level teen employment relative to what
would have happened in the absence of the minimum wage increase.
The second set of results comes from using the conditional parallel trends assumption; that is, we
assume only that counties with the same characteristics would follow the same trend in teen employment
in the absence of treatment. The county characteristics that we use are region of the country, county
population, county median income, the fraction of the population that is white, the fraction of the
population with a high school education, and the county‚Äôs poverty rate. We use the doubly robust
estimation procedure discussed above. Thus, estimation requires a first step estimation of the generalized
propensity score and outcome regression discussed above. For each generalized propensity score, we
estimate a logit model that includes each county characteristic along with quadratic terms for population
and median income.18 For the outcome regressions, we use the same specification for the covariates.
Before presenting these results, we note that our doubly robust estimation procedure is not computationally demanding. Our estimates of group-time average treatment effects in this section (across all
groups and time periods and including our multiplier bootstrap with 1000 iterations) run in 3.0 seconds on
a laptop with a 2.80-GHz Intel i5 processor with 8GB of RAM and without using any parallel processing.
For comparison‚Äôs sake, we first estimate the coefficient on a post-treatment dummy variable in a model
with unit fixed effects and region-year fixed effects. This is very similar to one of the sorts of models
that Dube et al. (2010) finds to eliminate the correlation between the minimum wage and employment.
Like Dube et al. (2010), using this specification, we find that the estimated coefficient is small and not
statistically different from 0. However, one must have in mind that the approach we proposed in this
article is different from the two-way fixed effects regression. In particular, we explicitly identify grouptime average treatment effects for different groups and different times, allowing for arbitrary treatment
effect heterogeneity as long as the conditional parallel trends assumption is satisfied. Thus, our causal
parameters have a clear interpretation. As pointed out by Wooldridge (2005a), Chernozhukov et al.
(2013), de Chaisemartin and D‚ÄôHaultf≈ìuille (2020), Borusyak and Jaravel (2017), Goodman-Bacon (2019)
and SloczynÃÅski (2018), the same may not be true for two-way fixed effects regressions in the presence of
treatment effect heterogeneity.19
The results using our approach are available in Panel (b) in Figure 1 and Panel (b) in Table 3.
Interestingly, we find quite different results using our approach than are suggested by the two-way fixed
effects regression approach. In particular, we continue to find evidence that increasing the minimum wage
tended to reduce teen employment. The estimated group-time average treatment effects range from 0.9%
lower teen employment (not statistically different from 0) in 2006 for the group of states first treated
in 2006 to 7.1% lower teen employment in 2007 for states first treated in 2004. Now, 3 of 7 group-time
average treatment effects are statistically significant. The average effect of increasing the minimum wage
18

Using the propensity score specification tests proposed by Sant‚ÄôAnna and Song (2019), we fail to reject the null hypothesis that these models are correctly specified at the usual significance levels.
19
Our approach is also different from that of Dube et al. (2010) in several other ways that are worth mentioning. We focus
on teen employment; Dube et al. (2010) considers employment in the restaurant industry. Their most similar specification to
the one mentioned above includes census division-time fixed effects rather than region-time fixed effects though the results
are similar. Finally, our period of analysis is different from theirs; in particular, there are no federal minimum wage changes
over the periods we analyze.

31

on teen employment across all groups that increased their minimum wage is a 3.1% reduction in teen
employment. This estimate is much different from the TWFE estimate. In addition, the pattern of
dynamic treatment effects where the magnitude of the effect of increasing the minimum wage tends to
increase with length of exposure is the same as in the unconditional case.
Overall, our results suggest that increasing the minimum wage decreased teen employment relative to
what it would have been without the policy change. However, there are some important limitations of our
application. First, some of the estimates of pseudo group-time average treatment effects in pre-treatment
periods in Figure 1 are significantly different from zero which provides some suggestive evidence against
the parallel trends assumption. Second, as discussed in the Supplementary Appendix, there is some
heterogeneity in the size of the minimum wage increase itself across states which could complicate the
interpretation of our results. Together, these suggest that our results should be interpreted with some
caution. That being said, we think that the key takeaway from the application is that, (implicitly) holding
the main identifying assumptions constant, in a prominent application in economics that has many very
common features (treatment effect heterogeneity, dynamic effects, and staggered treatment adoption) the
choice of estimation method can potentially lead to qualitatively different conclusions.

6

Conclusion

This paper has considered Difference-in-Differences methods in the case where there are more than two
time periods and units can become treated at different points in time ‚Äì a commonly encountered setup
in empirical work in economics. In this setup, we have proposed group-time average treatment effects,
AT T (g, t), that are the average treatment effect in period t for the group of units first treated in period
g. Unlike the more common approach of including a post-treatment dummy variable in a two-way fixed
effects regression, AT T (g, t) corresponds to a well defined treatment effect parameter. We also showed
that once AT T (g, t) has been obtained for different values of g and t, they can be aggregated into other
parameters to more concisely summarize heterogeneity with respect to some particular dimension of
interest (such as length of exposure to the treatment) or, alternatively, into a single overall treatment
effect parameter. In addition, our approach is suitable (i) for cases where the parallel trends assumption
holds only after conditioning on covariates, (ii) using different comparison groups such as the nevertreated or not-yet-treated, and (iii) when units can anticipate participating in the treatment and may
adjust their behavior before the treatment is implemented. We view such flexibility as an important
component of our proposed methodology.
We also provided nonparametric identification results leading to outcome regression, inverse probability weighting, and doubly robust estimands. Given that our nonparametric identification results are
constructive, we proposed to estimate AT T (g, t) using its sample analogue. We established consistency
and asymptotic normality of the proposed estimators, and proved the validity of a powerful, but easy
to implement, multiplier bootstrap procedure to construct simultaneous confidence bands for AT T (g, t).
The computational costs of our approach are generally low, and code for implementing our approach is
available in the R did package.
Finally, we applied our approach to study the effect of minimum wage increases on teen employment.
We found some evidence that increasing the minimum wage led to reductions in teen employment. More
32

interestingly though, in some cases we found notable differences between the results coming from our
approach relative to the more common two-way fixed effects approach. These differences suggest that
using an approach that is robust to treatment effect heterogeneity and dynamics should be strongly
considered by applied researchers.

Appendix A: Proofs of Main Results
We provide the proofs of our results in this appendix. Before proceeding, we first state and prove several auxiliary
lemmas that help us to prove our main theorems.
Let
AT TX (g, t) = E[Yt (g) ‚àí Yt (0)|X, Gg = 1].

Lemma A.1. Let Assumptions 1, 2, 3, 4, and 6 hold. Then, for all g and t such that g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥}
and t ‚â• g ‚àí Œ¥,
AT TX (g, t) = E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, Gg = 1] ‚àí E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, C = 1] a.s..
Proof of Lemma A.1: In what follows, take all equalities to hold almost surely (a.s.). Then, we have that
AT TX (g, t) = E[Yt (g) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1] ‚àí E[Yt (0) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1]
= E[Yt (g) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1] ‚àí

t‚àíg‚àíŒ¥
X

E[‚àÜYt‚àí` (0) |X, Gg = 1]

`=0

= E[Yt (g) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1] ‚àí

t‚àíg‚àíŒ¥
X

E[‚àÜYt‚àí` (0) |X, C = 1]

`=0

= E[Yt (g) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1] ‚àí E[Yt (0) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, C = 1]
= E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, Gg = 1] ‚àí E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, C = 1
where the first equality follows from adding and subtracting E[Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1], the second equality from
simple algebra, the third equality by Assumption 4, the fourth equality by simple algebra, and the last equality
from (2.1) and Assumption 3. 

Lemma A.2. Let Assumptions 1, 2, 3, 5 and 6 hold. Then, for all g and t such that g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥}
with g ‚àí Œ¥ ‚â§ t < gÃÑ
AT TX (g, t) = E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, Gg = 1] ‚àí E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, Dt+Œ¥ = 0, Gg = 0] a.s..
Proof of Lemma A.2: The proof follows similar steps as the proof of Lemma A.1. Taking all equalities to hold
almost surely (a.s.), we have that
AT TX (g, t) = E[Yt (g) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1] ‚àí E[Yt (0) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1]
= E[Yt (g) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1] ‚àí

t‚àíg‚àíŒ¥
X

E[‚àÜYt‚àí` (0) |X, Gg = 1]

`=0

= E[Yt (g) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1] ‚àí

t‚àíg‚àíŒ¥
X
`=0

33

E[‚àÜYt‚àí` (0) |X, Dt+Œ¥ = 0, Gg = 0]

= E[Yt (g) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1] ‚àí E[Yt (0) ‚àí Yg‚àíŒ¥‚àí1 (0) |X, Dt+Œ¥ = 0, Gg = 0]
= E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, Gg = 1] ‚àí E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, Dt+Œ¥ = 0, Gg = 0]
where the first equality follows from adding and subtracting E[Yg‚àíŒ¥‚àí1 (0) |X, Gg = 1], the second equality from
simple algebra, the third equality by Assumption 5 with s = t + Œ¥, the fourth equality by simple algebra, and the
last equality from (2.1) and Assumption 3. 
Now, we are ready to proceed with the proofs of our main theorems.
Proof of Theorem 1:
Part 1: Identification when Assumption 4 is invoked.
In this case, given the result in Lemma A.1,
AT T (g, t) = E[AT TX (g, t)|Gg = 1]
= E [ (E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, Gg = 1] ‚àí E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, C = 1])| Gg = 1]
Ô£π
Ô£Æ
Ô£∫
Ô£Ø
= E[Yt ‚àí Yg‚àíŒ¥‚àí1 |Gg = 1] ‚àí E Ô£Ø
|X, C = 1]|Gg = 1Ô£∫
Ô£ª
Ô£∞|E[Yt ‚àí Yg‚àíŒ¥‚àí1
{z
}
=mnev
g,t,Œ¥ (X)



Gg
nev
Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mg,t,Œ¥ (X) .
=E
E [Gg ]


nev
Hence, we have that AT T (g, t) = AT Tor
(g, t; Œ¥) .
nev
Next, to show that AT T (g, t) = AT Tipw
(g, t; Œ¥), it suffices to show that




pg (X) C
E
(Yt ‚àí Yg‚àíŒ¥‚àí1 )
E [Gg ¬∑ E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, C = 1]]
(1 ‚àí pg (X))


=
.
pg (X) C
E [Gg ]
E
(1 ‚àí pg (X))

(A.1)

Towards this end, by noticing that
pg (X) =

E [C|X]
E [Gg |X]
, 1 ‚àí pg (X) =
,
E [Gg + C|X]
E [Gg + C|X]

(A.2)

it follows that





pg (X) C
E [Gg |X] C
E
=E
1 ‚àí pg (X)
E [C|X]


E [Gg |X] E [C|X]
=E
E [C|X]
= E [E [Gg |X]]
= E [Gg ] .
Next, by exploiting (A.2) and applying the law of iterated expectations, we have that




pg (X) C
E [Gg |X] C
E
(Yt ‚àí Yg‚àíŒ¥‚àí1 ) = E
(Yt ‚àí Yg‚àíŒ¥‚àí1 )
(1 ‚àí pg (X))
E [C|X]


E [Gg |X]
=E
E [ C ¬∑ (Yt ‚àí Yg‚àíŒ¥‚àí1 )| X]
E [C|X]
= E [E [Gg |X] ¬∑ E [ (Yt ‚àí Yg‚àíŒ¥‚àí1 )| X, C = 1]]

34

(A.3)

= E [Gg ¬∑ E [ (Yt ‚àí Yg‚àíŒ¥‚àí1 )| X, C = 1]] .
nev
Thus, combined this with (A.3), we establish (A.1), implying that AT T (g, t) = AT Tipw
(g, t; Œ¥).
Finally, notice that
Ô£π
Ô£∂
Ô£ÆÔ£´
pg (X) C
Ô£ØÔ£¨ Gg
Ô£∫
1 ‚àí pg (X) Ô£∑
nev
nev
Ô£∫
Ô£∑
Ô£¨
AT Tdr
(g, t; Œ¥) = E Ô£Ø
Ô£∞Ô£≠ E [Gg ] ‚àí  pg (X) C  Ô£∏ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mg,t,Œ¥ (X) Ô£ª
E
1 ‚àí pg (X)
Ô£ÆÔ£´
Ô£π
Ô£∂
pg (X) C
Ô£ØÔ£¨ Gg
Ô£∫
1 ‚àí pg (X) Ô£∑
Ô£¨
Ô£∫
Ô£∑
= EÔ£Ø
Ô£∞Ô£≠ E [Gg ] ‚àí  pg (X) C  Ô£∏ (Yt ‚àí Yg‚àíŒ¥‚àí1 )Ô£ª
E
1 ‚àí pg (X)
|
{z
}
nev (g,t;Œ¥)
‚â°AT Tipw

Ô£π
Ô£∂
pg (X) C
Ô£ØÔ£¨ Gg
Ô£∫
1 ‚àí pg (X) Ô£∑
Ô£¨
Ô£∫
Ô£∑ nev
‚àí EÔ£Ø
Ô£∞Ô£≠ E [Gg ] ‚àí  pg (X) C  Ô£∏ mg,t,Œ¥ (X)Ô£ª
E
1 ‚àí pg (X)



1
E [Gg |X] C
= AT T (g, t) ‚àí
E Gg ‚àí
mnev
(X)
g,t,Œ¥
E [Gg ]
E [C|X]


1
= AT T (g, t) ‚àí
E (E [Gg |X] ‚àí E [Gg |X]) ¬∑ mnev
g,t,Œ¥ (X)
E [Gg ]
Ô£ÆÔ£´

= AT T (g, t) .
nev
where the third equality follows from AT Tipw
(g, t; Œ¥) = AT T (g, t), (A.2) and (A.3), and the fourth equality from

the law of iterated expectations.
Part 2: Identification when Assumption 5 is invoked.
In this case, given the result in Lemma A.2,
AT T (g, t) = E[AT TX (g, t)|Gg = 1]
= E [ (E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, Gg = 1] ‚àí E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, Dt+Œ¥ = 0, Gg = 0])| Gg = 1]
Ô£π
Ô£Æ
Ô£Ø
Ô£∫
Ô£∫
= E[Yt ‚àí Yg‚àíŒ¥‚àí1 |Gg = 1] ‚àí E Ô£Ø
Ô£∞|E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X,{zDt+Œ¥ = 0, Gg = 0]}|Gg = 1Ô£ª
=mny
g,t,Œ¥ (X)


=E

Gg
E [Gg ]




Yt ‚àí Yg‚àí1‚àía ‚àí mny
(X)
.
g,t,Œ¥

ny
Hence, we have that AT T (g, t) = AT Tor
(g, t; Œ¥) .
ny
Next, to show that AT T (g, t) = AT Tipw (g, t; Œ¥), it suffices to show that


E


pg,t+Œ¥ (X) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
(Yt ‚àí Yg‚àíŒ¥‚àí1 )
E [Gg ¬∑ E[Yt ‚àí Yg‚àíŒ¥‚àí1 |X, Dt+Œ¥ = 0, Gg = 0]]
1 ‚àí pg,t+Œ¥ (X)


.
=
pg,t+Œ¥ (X) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
E [Gg ]
E
1 ‚àí pg,t+Œ¥ (X)

(A.4)

Towards this end, recall that pg,t+Œ¥ (X) = P (Gg = 1|X, Gg + (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg ) = 1) and also notice that
pg,t+Œ¥ (X) =

E [Gg |X]
E [(1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg ) |X]
, 1 ‚àí pg (X) =
,
E [Gg + (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg ) |X]
E [Gg + (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg ) |X]

35

(A.5)

it follows that by the law of iterated expectations,




pg,t+Œ¥ (X) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
E [Gg |X] (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
E
=E
1 ‚àí pg,t+Œ¥ (X)
E [(1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg ) |X]
= E [Gg ] .

(A.6)

Next, by exploiting (A.5) and applying the law of iterated expectations, we have that


pg,t+Œ¥ (X) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
(Yt ‚àí Yg‚àíŒ¥‚àí1 )
E
1 ‚àí pg,t+Œ¥ (X)


E [Gg |X] (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
=E
(Yt ‚àí Yg‚àíŒ¥‚àí1 )
E [(1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg ) |X]


E [Gg |X]
=E
E [ (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg ) ¬∑ (Yt ‚àí Yg‚àíŒ¥‚àí1 )| X]
E [(1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg ) |X]
= E [E [Gg |X] ¬∑ E [ (Yt ‚àí Yg‚àíŒ¥‚àí1 )| X, Dt+Œ¥ = 0, Gg = 0]]
= E [Gg ¬∑ E [ (Yt ‚àí Yg‚àíŒ¥‚àí1 )| X, Dt+Œ¥ = 0, Gg = 0]] .
ny
Thus, combined this with (A.6), we establish (A.4), implying that AT T (g, t) = AT Tipw
(g, t; Œ¥).
Finally, notice that
Ô£∂
Ô£π
Ô£ÆÔ£´
pg,t+Œ¥ (X) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
Ô£∫
Ô£∑
Ô£ØÔ£¨ Gg
1 ‚àí pg,t+Œ¥ (X)
ny
ny
Ô£∑
Ô£∫
Ô£¨
AT Tdr
(g, t; Œ¥) = E Ô£Ø
Ô£∞Ô£≠ E [Gg ] ‚àí  pg,t+Œ¥ (X) (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )  Ô£∏ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mg,t,Œ¥ (X) Ô£ª
E
1 ‚àí pg,t+Œ¥ (X)



1
E [Gg |X] (1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg )
ny
ny
= AT Tipw (g, t; Œ¥) ‚àí
E Gg ‚àí
mg,t,Œ¥ (X)
E [Gg ]
E [(1 ‚àí Dt+Œ¥ ) (1 ‚àí Gg ) |X]


1
E (E [Gg |X] ‚àí E [Gg |X]) ¬∑ mnev
= AT T (g, t) ‚àí
g,t,Œ¥ (X)
E [Gg ]

= AT T (g, t) .
nev
where the second equality follows from (A.5) and (A.6), and the third equality from AT Tipw
(g, t; Œ¥) = AT T (g, t)

and the law of iterated expectations.
Proof of Theorem 2: From Theorem 1 it follows that AT T (g, t)‚Äôs are point-identified for all groups g and
time periods t such that g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥} and t ‚â• g ‚àí Œ¥. For each (g, t) pair, the asymptotic linear
‚àö [ nev
T dr (g, t; Œ¥) ‚àí AT T (g, t)) follows from Theorem A.1(a) of Sant‚ÄôAnna and Zhao (2020),
representation of n(AT
whereas
dr,nev
‚àö
d
dr,nev
0
[
n(AT
T t‚â•(g‚àíŒ¥) ‚àí AT Tt‚â•(g‚àíŒ¥) ) ‚àí
‚Üí N (0, E[Œ®dr,nev
t‚â•(g‚àíŒ¥) (W )Œ®t‚â•(g‚àíŒ¥) (W ) ])
follows from the Lindeberg‚ÄìLeÃÅvy central limit theorem.
Proof of Theorem 3: Note that, by the conditional multiplier central limit theorem, see Lemma 2.9.5 in van der
Vaart and Wellner (1996), as n ‚Üí ‚àû,
n

1 X
d
‚àö
Vi ¬∑ Œ®dr,nev
N (0, Œ£),
t‚â•(g‚àíŒ¥) (Wi ) ‚Üí
‚àó
n i=1
dr,nev
0
where Œ£ = E[Œ®dr,nev
t‚â•(g‚àíŒ¥) (W )Œ®t‚â•(g‚àíŒ¥) (W ) ]. Thus, to conclude the proof that

‚àö



‚àó,dr,nev
dr,nev
d
[
[
n AT
T t‚â•(g‚àíŒ¥) ‚àí AT
T t‚â•(g‚àíŒ¥) ‚Üí N (0, Œ£),
‚àó

36

(A.7)

it suffices to show that, for all g and t such that g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥} and t ‚â• g ‚àí Œ¥,
n
h
i
1 X
dr,nev
dr,nev
‚àó,nev
‚àö
Vi ¬∑ œàbg,t,Œ¥
(Wi ; Œ∫
bnev
)
‚àí
œà
(W
;
Œ∫
)
= op‚àó (1) ,
i
g,t
g,t
g,t,Œ¥
n i=1

(A.8)


0
‚àó,nev 0
‚àó0
where Œ∫‚àó,nev
=
œÄ
,
Œ≤
is the vector of pseudo-true finite-dimensional parameters.
g,t
g
g,t,Œ¥
Towards this end, recall that
dr,nev
est,nev
nev
nev
btreat,nev (Wi ; Œ≤bnev ) ‚àí œàbcomp,nev (Wi ; œÄ
œàbg,t,Œ¥
(Wi ; Œ∫
bnev
bg , Œ≤bg,t,Œ¥
) ‚àí œàbg,t,Œ¥
(Wi ; œÄ
bg , Œ≤bg,t,Œ¥
)
g,t ) = œàg,t,Œ¥
g,t,Œ¥
g,t,Œ¥

where



treat,nev
nev
bnev
œàbg,t,Œ¥
(W ; Œ≤bg,t,Œ¥
)=w
bgtreat ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
Œ≤
g,t,Œ¥
g,t,Œ¥
h


i
bnev
‚àíw
bgtreat ¬∑ En w
bgtreat ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
,
g,t,Œ¥ Œ≤g,t,Œ¥



comp,nev
nev
bnev
œàbg,t,Œ¥
(W ; œÄ
bg , Œ≤bg,t,Œ¥
)=w
bgcomp,nev (b
œÄg ) ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
g,t,Œ¥ Œ≤g,t,Œ¥
h


i
bnev
‚àíw
bgcomp (b
œÄg ) ¬∑ En wgcomp (b
œÄg ) ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
,
g,t,Œ¥ Œ≤g,t,Œ¥

0
0 cdr,nev,2
est,nev
or,nev bnev
nev
cdr,nev,1 + lgps,nev (b
œàbg,t
(W ; œÄ
bg , Œ≤bg,t,Œ¥
) = lg,t
Œ≤g,t,Œ¥ ¬∑ M
œÄg ) ¬∑ M
,
g,t,Œ¥
g,t,Œ¥
with
Gg
,
w
bgtreat =
En [Gg ]

pbg (X; œÄ
bg ) C
1
‚àí
p
b
(X;
œÄ
bg )
g
,

w
bgcomp,nev (b
œÄg ) =
pbg (X; œÄ
bg ) C
En
1 ‚àí pbg (X; œÄ
bg )

and

i

bnev
w
bgtreat ‚àí w
bgcomp,nev (b
œÄg ) ¬∑ mÃánev
Œ≤
,
g,t,Œ¥
g,t,Œ¥
h



i
bnev
cdr,nev,2 = En Œ±
M
bgps,nev (b
œÄg ) ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
¬∑ pÃág (b
œÄg )
g,t,Œ¥ Œ≤g,t,Œ¥
g,t,Œ¥
h



i
bnev
‚àí En Œ±
bgps,nev (b
œÄg ) ¬∑ w
bgcomp,nev (b
œÄg ) ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
Œ≤
¬∑
pÃá
(b
œÄ
)
,
g
g
g,t,Œ¥
g,t,Œ¥
,


pg (X; œÄ
bg ) C
C
E
.
Œ±
bgps,nev (b
œÄg ) =
n
2
1 ‚àí pg (X; œÄ
bg )
(1 ‚àí pg (X; œÄ
bg ))
cdr,nev,1 = En
M
g,t,Œ¥

h

We first show that
n


1 X
treat,nev
treat,nev
‚àó,nev
nev
‚àö
Vi ¬∑ œàbg,t,Œ¥
(Wi ; Œ≤bg,t,Œ¥
) ‚àí œàg,t,Œ¥
(Wi ; Œ≤g,t,Œ¥
) = op‚àó (1) .
n i=1

Using the mean-value theorem, we write
n

1 X
treat,nev
nev
‚àö
Vi ¬∑ œàbg,t,Œ¥
(Wi ; Œ≤bg,t,Œ¥
)
n i=1
n




1 X
‚àó,nev
treat
=‚àö
Vi ¬∑ w
bg,i
¬∑ Yi,t ‚àí Yi,g‚àíŒ¥‚àí1 ‚àí mnev
g,t,Œ¥ Wi ; Œ≤g,t,Œ¥
n i=1
‚àí

n
0 1 X

‚àö  nev
‚àó,nev
treat
nev
n Œ≤bg,t,Œ¥ ‚àí Œ≤g,t,Œ¥
Vi ¬∑ w
bg,i
¬∑ mÃánev
g,t,Œ¥ Wi ; Œ≤ÃÑg,t,Œ¥
n i=1

37

(A.9)

n
h


i 1 X
treat
bnev
‚àö
‚àí En w
bgtreat ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
Vi ¬∑ w
bg,i
Œ≤
g,t,Œ¥
g,t,Œ¥
n i=1
1,treat
2,treat
3,treat
= Ibg,t,Œ¥
‚àí Ibg,t,Œ¥
‚àí Ibg,t,Œ¥
,
‚àó,nev
‚àó,nev
nev
nev
nev
a.s.. From the strong law of
‚â§ Œ≤bg,t,Œ¥
‚àí Œ≤g,t,Œ¥
where Œ≤ÃÑg,t,Œ¥
is an intermediate point that satisfies Œ≤ÃÑg,t,Œ¥
‚àí Œ≤g,t,Œ¥
large numbers and the fact that V is mean zero, independent of W , it follows that
n




1 X
1,treat
‚àó,nev
treat
Ibg,t,Œ¥
=‚àö
+ op‚àó (1)
Vi ¬∑ wg,i
¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
g,t,Œ¥ Wi ; Œ≤g,t,Œ¥
n i=1
n

i
h

1 X
‚àó,nev
3,treat
treat
+ op‚àó (1)
Ibg,t,Œ¥
=‚àö
Vi ¬∑ wg,i
¬∑ E wgtreat ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
g,t,Œ¥ Œ≤g,t,Œ¥
n i=1
2,treat
Similarly, from Assumptions 7 and 8, and the strong law of large numbers, we conclude that Ibg,t,Œ¥
= op‚àó (1). Now

(A.9) follows from combining these results.
Next, we show
n



1 X
comp,nev
comp,nev
‚àó,nev
nev
‚àö
Vi ¬∑ œàbg,t,Œ¥
(Wi ; œÄ
bg , Œ≤bg,t,Œ¥
) ‚àí œàg,t,Œ¥
(Wi ; œÄg‚àó , Œ≤g,t,Œ¥
) = op‚àó (1) .
n i=1
Again, by the mean value theorem, we write
n

1 X
comp,nev
nev
‚àö
Vi ¬∑ œàbg,t,Œ¥
(Wi ; œÄ
bg , Œ≤bg,t,Œ¥
)
n i=1
n




1 X
‚àó,nev
=‚àö
Vi ¬∑ w
bgcomp,nev (Wi ; œÄ
bg ) ¬∑ Yi,t ‚àí Yi,g‚àíŒ¥‚àí1 ‚àí mnev
g,t,Œ¥ Wi ; Œ≤g,t,Œ¥
n i=1
‚àí

n
0 1 X

‚àö  nev
‚àó,nev
nev
n Œ≤bg,t,Œ¥ ‚àí Œ≤g,t,Œ¥
Vi ¬∑ w
bgcomp,nev (Wi ; œÄ
bg ) ¬∑ mÃánev
g,t,Œ¥ Wi ; Œ≤ÃÑg,t,Œ¥
n i=1

n
h


i 1 X
bnev
‚àö
Vi ¬∑ w
bgcomp,nev (Wi ; œÄ
bg )
‚àí En w
bgcomp,nev (b
œÄg ) ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
Œ≤
g,t,Œ¥
g,t,Œ¥
n i=1

pg Xi ; œÄg‚àó Ci

n



1 ‚àí pg X; œÄg‚àó
1 X
‚àó,nev

 ¬∑ Yi,t ‚àí Yi,g‚àíŒ¥‚àí1 ‚àí mnev
=‚àö
Vi ¬∑
W
;
Œ≤
i
g,t,Œ¥
g,t,Œ¥
pbg (X; œÄ
bg ) C
n i=1
En
1 ‚àí pbg (X; œÄ
bg )
Ci
n
2



0 1 X
‚àö
(1 ‚àí pg (Xi ; œÄÃÑg ))
‚àó,nev

 ¬∑ Yi,t ‚àí Yi,g‚àíŒ¥‚àí1 ‚àí mnev
bg ‚àí œÄg‚àó
Vi ¬∑
+ n œÄ
W
;
Œ≤
¬∑ pÃág (Xi ; œÄÃÑg )
i
g,t,Œ¥
g,t,Œ¥
pbg (X; œÄ
bg ) C
n i=1
En
1 ‚àí pbg (X; œÄ
bg )
n


X
0 1

‚àö
‚àó,nev
nev
nev
‚àí n Œ≤bg,t,Œ¥
‚àí Œ≤g,t,Œ¥
Vi ¬∑ w
bgcomp,nev (Wi ; œÄ
bg ) ¬∑ mÃánev
g,t,Œ¥ Wi ; Œ≤ÃÑg,t,Œ¥
n i=1

pg Xi ; œÄg‚àó Ci

n
X
1 ‚àí pg Xi ; œÄg‚àó
comp 1
c


‚àí Mg,t,Œ¥ ‚àö
Vi ¬∑
pbg (X; œÄ
bg ) C
n i=1
En
1 ‚àí pbg (X; œÄ
bg )
Ci
n
2
X
0 1
‚àö
(1 ‚àí pg (Xi ; œÄÃÑg ))
ccomp n œÄ

 ¬∑ pÃág (Xi ; œÄÃÑg )
‚àíM
bg ‚àí œÄg‚àó
Vi ¬∑
g,t,Œ¥
pbg (X; œÄ
bg ) C
n i=1
En
1 ‚àí pbg (X; œÄ
bg )

38

(A.10)

1,comp
2,comp
3,comp
4,comp
5,comp
= Ibg,t,Œ¥
+ Ibg,t,Œ¥
‚àí Ibg,t,Œ¥
‚àí Ibg,t,Œ¥
‚àí Ibg,t,Œ¥
,
‚àó,nev
‚àó,nev
nev
nev
nev
a.s. and œÄÃÑg ‚àí œÄg‚àó ‚â§
‚àí Œ≤g,t,Œ¥
‚â§ Œ≤bg,t,Œ¥
‚àí Œ≤g,t,Œ¥
where Œ≤ÃÑg,t,Œ¥
and œÄÃÑg are intermediate points that satisfies Œ≤ÃÑg,t,Œ¥

œÄ
bg ‚àí œÄg‚àó a.s., respectively, and
i

h

comp,nev
nev
bnev
ccomp = En w
.
Œ≤
M
b
(b
œÄ
)
¬∑
Y
‚àí
Y
‚àí
m
g
t
g‚àíŒ¥‚àí1
g,t,Œ¥
g
g,t,Œ¥
g,t,Œ¥
From the strong law of large numbers and the fact that V is mean zero, has variance one, and is independent of
W , it follows that
n



 
1 X
1,comp
‚àó,nev
Ibg,t,Œ¥
=‚àö
W
;
Œ≤
+ op‚àó (1) ,
Vi ¬∑ wgcomp,nev Wi ; œÄg‚àó ¬∑ Yi,t ‚àí Yi,g‚àíŒ¥‚àí1 ‚àí mnev
i
g,t,Œ¥
g,t,Œ¥
n i=1
n

i
h


1 X
‚àó,nev
3,treat
Ibg,t,Œ¥
=‚àö
Vi ¬∑ wgcomp,nev Wi ; œÄg‚àó ¬∑ E wgcomp ¬∑ Yt ‚àí Yg‚àíŒ¥‚àí1 ‚àí mnev
Œ≤
+ op‚àó (1) .
g,t,Œ¥
g,t,Œ¥
n i=1

Similarly, from Assumptions 7 and 8, and the strong law of large numbers, we conclude that
2,comp
4,comp
5,comp
Ibg,t,Œ¥
= Ibg,t,Œ¥
= Ibg,t,Œ¥
= op‚àó (1) .

Now (A.10) follows from combining these results.
Next, we show that
n


1 X
est,nev
est,nev
‚àó,nev
nev
‚àö
Vi ¬∑ œàbg,t
(Wi ; œÄ
bg , Œ≤bg,t,Œ¥
) ‚àí œàg,t
(Wi ; œÄg‚àó , Œ≤g,t,Œ¥
) = op‚àó (1) .
n i=1

From the strong law of large numbers and Assumptions 7 and 8,
n

1 X
est,nev
nev
‚àö
Vi ¬∑ œàbg,t
(Wi ; œÄ
bg , Œ≤bg,t,Œ¥
)
n i=1


n

0
1 X
0
or,nev
dr,nev,1
dr,nev,2
nev
ps,nev
b
=‚àö
Vi ¬∑ lg,t
Wi ; Œ≤g,t,Œ¥ ¬∑ Mg,t,Œ¥
+ lg
(Wi ; œÄ
bg ) ¬∑ Mg,t,Œ¥
+ op‚àó (1)
n i=1
n


1 X
est
=‚àö
Vi ¬∑ lg,t
Wi ; Œ∫
bnev
+ op‚àó (1) ,
g,t
n i=1
0

nev 0
0
,
where, for a generic Œ∫nev
g,t = œÄg , Œ≤g,t,Œ¥


0
or,nev
dr,nev,1
dr,nev,2
est
nev 0
lg,t
W ; Œ∫nev
= lg,t
W ; Œ≤g,t,Œ¥
¬∑ Mg,t,Œ¥
+ lgps,nev (Wi ; œÄg ) ¬∑ Mg,t,Œ¥
g,t
Thus, from Lemma 4.3 in Newey and McFadden (1994) and Assumption 7, it follows that
!
n




1 X
‚àó,nev
‚àó
est
nev
est
‚àö
V ar
Vi ¬∑ lg,t Wi ; Œ∫
bg,t,Œ¥ ‚àí lg,t Wi ; Œ∫g,t,Œ¥
n i=1
n

=


2

1 X  est
‚àó,nev
est
lg,t Wi ; Œ∫
bnev
g,t,Œ¥ ‚àí lg,t Wi ; Œ∫g,t,Œ¥
n i=1

= op (1) ,
which, in turn, implies (A.11).

39

(A.11)

Taking (A.9), (A.10), and (A.11) together, we then establish (A.8). Thus, by (A.7), we have


‚àó,dr,nev
dr,nev
‚àö
d
[
[
n AT T t‚â•(g‚àíŒ¥) ‚àí AT T t‚â•(g‚àíŒ¥) ‚Üí N (0, Œ£).
‚àó

Finally, by the continuous mapping theorem, see e.g. Theorem 10.8 in Kosorok (2008), for any continuous
functional Œì(¬∑)



‚àó,dr,nev
dr,nev
‚àö
d
[
[
Œì
n AT T t‚â•(g‚àíŒ¥) ‚àí AT T t‚â•(g‚àíŒ¥)
‚Üí Œì (N (0, Œ£)) ,
‚àó

concluding our proof. 

Appendix B: Additional Results for Repeated Cross Sections
In this section we extend our identification results to the case where one has access to repeated cross sections data
instead of panel data. Here we assume that for each unit in the pooled sample, we observe (Y, G2 , . . . , GT , C, T, X)
where T ‚àà {1, . . . , T } denotes the time period when that unit is observed. Let Tt = 1 if an observation is observed
at time t, and zero otherwise.
We assume that random samples are available for each time period.

Assumption B.1. Conditional of T = t, the data are independent and identically distributed from the distribution
of (Yt , G2 , . . . , GT , C, X) , for all t = 1, . . . , T ., with (G2 , . . . , GT , C, X) being invariant to T .
Assumption B.1 implies that our sample consists of random draws from the mixture distribution
FM (y, g2 , . . . , gT , c, t, x) =

T
X

Œªt ¬∑ FY,G2 ,...,GT ,C,X|T (y, g2 , . . . , gT , c, x|t),

t=1

where Œªt = P (Tt = 1). It also rules-out compositional changes across time. This assumption is related to the
sampling assumption imposed by Abadie (2005) and Sant‚ÄôAnna and Zhao (2020) in the two periods, two groups
DiD setup. Notice that, once one conditions on the time period, then expectations under the mixture distribution
correspond to population expectations. Also, because X, Gg , and C are observed for all units, by the stationarity
condition one can use draws from the mixture distribution to estimate the generalized propensity score. With some
abuse of notation, we then use pg,s (X) as a short notation for EM [Gg |X, Gg + (1 ‚àí Ds ) (1 ‚àí Gg ) = 1], where EM [¬∑]
denotes expectations with respect to FM (¬∑). Also, we use pg (X) = pg,T (X) = EM [Gg |X, Gg + C = 1].
Before formalizing all the results, we need to introduce some additional notation. Let mrc,nev
(x) ‚â° EM [Y |X =
c,t
rc,treat
rc,ny
x, C = 1, T = t], mg,t
(x) ‚â° EM [Y |X = x, Gg = 1, T = t] and ms,t (x) ‚â° EM [Y |X = x, Ds = 0, Gg = 0, T =
t]. Consider the weights
wtreat (a, b) = Tb ¬∑ Ga / EM [Tb ¬∑ Ga ] ,



Tb ¬∑ pa (X) C
Tb ¬∑ pa (X) C
comp
EM
,
wnev
(a, b) =
1 ‚àí pa (X)
1 ‚àí pa (X)



Tb ¬∑ pa,s (X) (1 ‚àí Db ) (1 ‚àí Ga )
Tb ¬∑ pa,s (X) (1 ‚àí Db ) (1 ‚àí Ga )
comp
wny
(a, b, s) =
EM
.
1 ‚àí pa,s (X)
1 ‚àí pa,s (X)
Finally, consider the outcome regression (OR) estimands,


 

Gg
rc,treat
rc,nev
rc,nev
nev
AT Tor,rc
(g, t; Œ¥) = EM
mrc,treat
(X)
‚àí
m
(X)
‚àí
m
(X)
‚àí
m
(X)
,
g,t
c,t
g,g‚àíŒ¥‚àí1
c,g‚àíŒ¥‚àí1
EM [Gg ]

40

ny
AT Tor,rc
(g, t; Œ¥) = EM




 

Gg
rc,treat
rc,treat
rc,ny
rc,ny
mg,t
(X) ‚àí mg,g‚àíŒ¥‚àí1 (X) ‚àí mt+Œ¥,t (X) ‚àí mt+Œ¥,g‚àíŒ¥‚àí1 (X)
,
EM [Gg ]

the inverse probability weighted (IPW) estimands
nev
AT Tipw,rc
(g, t; Œ¥) = EM





wtreat (g, t) ‚àí wtreat (g, g ‚àí Œ¥ ‚àí 1) ¬∑ Y

comp
comp
‚àí EM [(wnev
(g, t) ‚àí wnev
(g, g ‚àí Œ¥ ‚àí 1)) ¬∑ Y ] ,



ny
treat
treat
AT Tipw,rc (g, t; Œ¥) = EM w
(g, t) ‚àí w
(g, g ‚àí Œ¥ ‚àí 1) ¬∑ Y
 comp


comp
‚àí EM wny
(g, t, t + Œ¥) ‚àí wny
(g, g ‚àí Œ¥ ‚àí 1, t + Œ¥) ¬∑ Y ,

and the doubly-robust (DR) estimands


 

Gg
rc,treat
rc,treat
rc,nev
rc,nev
nev
mg,t
(X) ‚àí mg,g‚àíŒ¥‚àí1 (X) ‚àí mc,t
(X) ‚àí mc,g‚àíŒ¥‚àí1 (X)
AT Tdr,rc (g, t; Œ¥) = EM
EM [Gg ]
h

i

rc,treat
treat
+ EM wtreat (g, t) Y ‚àí mrc,treat
(X)
‚àí
w
(g,
g
‚àí
Œ¥
‚àí
1)
Y
‚àí
m
(X)
g,t
g,g‚àíŒ¥‚àí1
h

i

rc,nev
rc,nev
comp
comp
‚àí EM wnev
(g, t) Y ‚àí mc,t
(X) ‚àí wnev
(g, g ‚àí Œ¥ ‚àí 1) Y ‚àí mc,g‚àíŒ¥‚àí1 (X) ,


 

Gg
ny
rc,treat
rc,treat
rc,ny
rc,ny
AT Tdr,rc (g, t; Œ¥) = EM
mg,t
(X) ‚àí mg,g‚àíŒ¥‚àí1 (X) ‚àí mt+Œ¥,t (X) ‚àí mt+Œ¥,g‚àíŒ¥‚àí1 (X)
EM [Gg ]

i
h

rc,treat
treat
+ EM wtreat (g, t) Y ‚àí mrc,treat
(X)
‚àí
w
(g,
g
‚àí
Œ¥
‚àí
1)
Y
‚àí
m
(X)
g,t
g,g‚àíŒ¥‚àí1
h



i
rc,ny
comp
comp
‚àí EM wny
(g, t, t + Œ¥) Y ‚àí mt+Œ¥,t (X) ‚àí wny
(g, g ‚àí Œ¥ ‚àí 1, t + Œ¥) Y ‚àí mrc,ny
.
t+Œ¥,g‚àíŒ¥‚àí1 (X)

The OR, IPW and DR estimands respectively generalize Heckman et al. (1997), Abadie (2005) and Sant‚ÄôAnna
and Zhao (2020) estimands for the two groups, two periods DiD setup to the staggered DiD setup with multiple
periods and multiple groups.

Theorem B.1. Let Assumptions 1, 3, 6, and B.1 hold.
(i) If Assumption 4 in the main text holds, then, for all g and t such that g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥} and t ‚â• g ‚àíŒ¥,
nev
nev
nev
AT T (g, t) = AT Tipw,rc
(g, t; Œ¥) = AT Tor,rc
(g, t; Œ¥) = AT Tdr,rc
(g, t; Œ¥) .

(ii) If Assumption 5 in the main text holds, then, for all g and t such that g ‚àà GŒ¥ , t ‚àà {2, . . . T ‚àí Œ¥} and
t ‚â• g ‚àí Œ¥,
ny
ny
ny
AT T (g, t) = AT Tipw,rc
(g, t; Œ¥) = AT Tor,rc
(g, t; Œ¥) = AT Tdr,rc
(g, t; Œ¥) .
We defer the proof of Theorem B.1 to the Supplementary Appendix. The identification results in Theorem B.1
suggest a simple two-step estimation procedure for the AT T (g, t) with repeated cross-section data that is analogous
to the panel data case discussed in Section 4. The asymptotic properties of such two-step estimators follow from
analogous arguments; the details are omitted for brevity. Likewise, we can aggregate these estimators to provide
summary measures of the causal effects like those discussed in Section 3.

References
Abadie, A. (2005), ‚ÄúSemiparametric difference-in-difference estimators,‚Äù Review of Economic Studies, 72, 1‚Äì19.

41

Abadie, A., Athey, S., Imbens, G., and Wooldridge, J. (2017), ‚ÄúWhen should you adjust standard errors for
clustering?,‚Äù Working Paper.
Abbring, J. H., and van den Berg, G. J. (2003), ‚ÄúThe nonparametric identification of treatment effects in duration
models,‚Äù Econometrica, 71(5), 1491‚Äì1517.
Ai, C., and Chen, X. (2003), ‚ÄúEfficient estimation of models with conditional moment restrictions containin unknown functions,‚Äù Econometrica, 71(6), 1795‚Äì1843.
Ai, C., and Chen, X. (2007), ‚ÄúEstimation of possibly misspecified semiparametric conditional moment restriction
models with different conditioning variables,‚Äù Journal of Econometrics, 141(1), 5‚Äì43.
Ai, C., and Chen, X. (2012), ‚ÄúThe semiparametric efficiency bound for models of sequential moment restrictions
containing unknown functions,‚Äù Journal of Econometrics, 170(2), 442‚Äì457.
Athey, S., and Imbens, G. W. (2006), ‚ÄúIdentification and inference in nonlinear difference in differences models,‚Äù
Econometrica, 74(2), 431‚Äì497.
Athey, S., and Imbens, G. W. (2018), ‚ÄúDesign-based analysis in difference-in-differences settings with staggered
adoption,‚Äù Working Paper.
Bailey, M. J., and Goodman-Bacon, A. (2015), ‚ÄúThe war on poverty‚Äôs experiment in public medicine: Community
health centers and the mortality of older Americans,‚Äù American Economic Review, 105(3), 1067‚Äì1104.
Belloni, A., Chernozhukov, V., FernaÃÅndez-Val, I., and Hansen, C. (2017), ‚ÄúProgram evaluation and causal inference
with high-dimensional data,‚Äù Econometrica, 85(1), 233‚Äì298.
Bertrand, M., Duflo, E., and Mullainathan, S. (2004), ‚ÄúHow much should we trust differences-in-differences estimates?,‚Äù The Quarterly Journal of Economics, 119(1), 249‚Äì275.
Bojinov, I., Rambachan, A., and Shephard, N. (2020), ‚ÄúPanel Experiments and Dynamic Causal Effects: A Finite
Population Perspective,‚Äù Working Paper.
Bonhomme, S., and Sauder, U. (2011), ‚ÄúRecovering distributions in difference-in-differences models: A comparison
of selective and comprehensive schooling,‚Äù Review of Economics and Statistics, 93(May), 479‚Äì494.
Borusyak, K., and Jaravel, X. (2017), ‚ÄúRevisiting event study designs,‚Äù Working Paper.
Botosaru, I., and Gutierrez, F. H. (2018), ‚ÄúDifference-in-differences when the treatment status is observed in only
one period,‚Äù Journal of Applied Econometrics, 33(1), 73‚Äì90.
Busso, M., Dinardo, J., and McCrary, J. (2014), ‚ÄúNew evidence on the finite sample properties of propensity score
reweighting and matching estimators,‚Äù The Review of Economics and Statistics, 96(5), 885‚Äì895.
Callaway, B., Li, T., and Oka, T. (2018), ‚ÄúQuantile treatment effects in difference in differences models under
dependence restrictions and with only two time periods,‚Äù Journal of Econometrics, 206(2), 395‚Äì413.
Card, D., and Krueger, A. B. (1994), ‚ÄúMinimum wages and employment: A case study of the fast-food industry in
New Jersey and Pennsylvania,‚Äù American Economic Review, 84(4), 772‚Äì793.
Chen, X., Hong, H., and Tarozzi, A. (2008), ‚ÄúSemiparametric efficiency in GMM models with auxiliary data,‚Äù The
Annals of Statistics, 36(2), 808‚Äì843.
Chen, X., Linton, O., and Van Keilegom, I. (2003), ‚ÄúEstimation of semiparametric models when the criterion
function is not smooth,‚Äù Econometrica, 71(5), 1591‚Äì1608.
Cheng, G., Yu, Z., and Huang, J. Z. (2013), ‚ÄúThe cluster bootstrap consistency in generalized estimating equations,‚Äù
Journal of Multivariate Analysis, 115, 33‚Äì47.
Chernozhukov, V., FernaÃÅndez-Val, I., Hahn, J., and Newey, W. (2013), ‚ÄúAverage and quantile effects in nonseparable
panel models,‚Äù Econometrica, 81(2), 535‚Äì580.
Chernozhukov, V., FernaÃÅndez-Val, I., and Luo, Y. (2018), ‚ÄúThe sorted effects method: Discovering heterogeneous
effects beyond their averages,‚Äù Econometrica, 86(6), 1911‚Äì1938.
Conley, T., and Taber, C. (2011), ‚ÄúInference with ‚Äúdifference in differences‚Äù with a small number of policy changes,‚Äù
Review of Economics and Statistics, 93(1), 113‚Äì125.

42

Crump, R. K., Hotz, V. J., Imbens, G. W., and Mitnik, O. A. (2009), ‚ÄúDealing with limited overlap in estimation
of average treatment effects,‚Äù Biometrika, 96(1), 187‚Äì199.
de Chaisemartin, C., and D‚ÄôHaultf≈ìuille, X. (2017), ‚ÄúFuzzy differences-in-differences,‚Äù The Review of Economic
Studies, 85, 999‚Äì1028.
de Chaisemartin, C., and D‚ÄôHaultf≈ìuille, X. (2020), ‚ÄúTwo-way fixed effects estimators with heterogeneous treatment effects,‚Äù American Economic Review, 110(9), 2964‚Äì2996.
Dube, A., Lester, T. W., and Reich, M. (2010), ‚ÄúMinimum wage effects across state borders: Estimates using
contiguous counties,‚Äù Review of Economics and Statistics, 92(4), 945‚Äì964.
Dube, A., Lester, T. W., and Reich, M. (2016), ‚ÄúMinimum wage shocks, employment flows, and labor market
frictions,‚Äù Journal of Labor Economics, 34(3), 663‚Äì704.
Farber, H. S. (2017), ‚ÄúEmployment, hours, and earnings consequences of job loss: US evidence from the displaced
workers survey,‚Äù Journal of Labor Economics, 35(S1), S235‚ÄìS272.
Ferman, B., and Pinto, C. (2019), ‚ÄúInference in differences-in-differences with few treated groups and heteroskedasticity,‚Äù Review of Economics and Statistics, 101(3), 452‚Äì467.
Freyberger, J., and Rai, Y. (2018), ‚ÄúUniform confidence bands: Characterization and optimality,‚Äù Journal of
Econometrics, 204(1), 119‚Äì130.
Gibbons, C. E., SuaÃÅrez Serrato, J. C., and Urbancic, M. B. (2018), ‚ÄúBroken or Fixed Effects?,‚Äù Journal of Econometric Methods, 8(1).
Goodman-Bacon, A. (2019), ‚ÄúDifference-in-differences with variation in treatment timing,‚Äù Working Paper.
Graham, B., Pinto, C., and Egel, D. (2012), ‚ÄúInverse probability tilting for moment condition models with missing
data,‚Äù The Review of Economic Studies, 79(3), 1053‚Äì1079.
HaÃÅjek, J. (1971), ‚ÄúDiscussion of ‚ÄòAn essay on the logical foundations of survey sampling, Part I‚Äô, by D. Basu,‚Äù
in Foundations of Statistical Inference, eds. V. P. Godambe, and D. A. Sprott, Toronto: Holt, Rinehart, and
Winston.
Han, S. (2020), ‚ÄúIdentification in nonparametric models for dynamic treatment effects,‚Äù Journal of Econometrics,
Forthcoming.
Heckman, J. J., Humphries, J. E., and Veramendi, G. (2016), ‚ÄúDynamic treatment effects,‚Äù Journal of Econometrics, 191(2), 276‚Äì292.
Heckman, J. J., Ichimura, H., Smith, J., and Todd, P. (1998), ‚ÄúCharacterizing selection bias using experimental
data,‚Äù Econometrica, 66(5), 1017‚Äì1098.
Heckman, J. J., Ichimura, H., and Todd, P. (1997), ‚ÄúMatching as an econometric evaluation estimator: Evidence
from evaluating a job training programme,‚Äù The Review of Economic Studies, 64(4), 605‚Äì654.
Imai, K., Kim, I. S., and Wang, E. (2018), ‚ÄúMatching methods for causal inference with time-series cross-section
data,‚Äù Working Paper.
Khan, S., and Tamer, E. (2010), ‚ÄúIrregular identification, support conditions, and inverse weight estimation,‚Äù
Econometrica, 78(6), 2021‚Äì2042.
Kline, P., and Santos, A. (2012), ‚ÄúA score based approach to wild bootstrap inference,‚Äù Journal of Econometric
Methods, 1(1), 1‚Äì40.
Kosorok, M. R. (2008), Introduction to Empirical Processes and Semiparametric Inference, New York, NY: Springer.
Laporte, A., and Windmeijer, F. (2005), ‚ÄúEstimation of panel data models with binary indicators when treatment
effects are not constant over time,‚Äù Economics Letters, 88(3), 389‚Äì396.
MacKinnon, J. G., and Webb, M. D. (2018), ‚ÄúThe wild bootstrap for few (treated) clusters,‚Äù The Econometrics
Journal, 21(2), 114‚Äì135.
MacKinnon, J. G., and Webb, M. D. (2020), ‚ÄúRandomization inference for difference-in-differences with few treated
clusters,‚Äù Journal of Econometrics, 218(2), 435‚Äì450.

43

Malani, A., and Reif, J. (2015), ‚ÄúInterpreting pre-trends as anticipation: Impact on estimated treatment effects
from tort reform,‚Äù Journal of Public Economics, 124, 1‚Äì17.
Mammen, E. (1993), ‚ÄúBootstrap and wild bootstrap for high dimensional linear models,‚Äù The Annals of Statistics,
21(1), 255‚Äì285.
Marcus, M., and Sant‚ÄôAnna, P. H. C. (2020), ‚ÄúThe role of parallel trends in event study settings : An application to
environmental economics,‚Äù Journal of the Association of Environmental and Resource Economists, Forthcoming.
McCrary, J. (2007), ‚ÄúThe effect of court-ordered hiring quotas on the composition and quality of police,‚Äù American
Economic Review, 97(1), 318‚Äì353.
Meer, J., and West, J. (2016), ‚ÄúEffects of the minimum wage on employment dynamics,‚Äù Journal of Human
Resources, 51(2), 500‚Äì522.
Montiel Olea, J. L., and Plagborg-M√∏ller, M. (2018), ‚ÄúSimultaneous confidence bands: Theory, implementation,
and an application to SVARs,‚Äù Journal of Applied Econometrics, pp. 1‚Äì64.
Murphy, S. A. (2003), ‚ÄúOptimal dynamic treatment regimes,‚Äù Journal of the Royal Statistical Society Series B,
65(2), 331‚Äì366.
Murphy, S. A., Van der Laan, M. J., Robins, J. M., Bierman, K. L., Coie, J. D., Greenberg, M. T., Lochman, J. E.,
McMahon, R. J., and Pinderhughes, E. (2001), ‚ÄúMarginal mean models for dynamic regimes,‚Äù Journal of the
American Statistical Association, 96(456), 1410‚Äì1423.
Neumark, D., and Wascher, W. (2000), ‚ÄúMinimum wages and employment: A case study of the fast-food industry
in New Jersey and Pennsylvania: Comment,‚Äù American Economic Review, 90(5), 1362‚Äì1396.
Neumark, D., and Wascher, W. L. (2008), Minimum Wages, Cambridge, MA: The MIT Press.
Newey, W. K. (1994), ‚ÄúThe asymptotic variance of semiparametric estimators,‚Äù Econometrica, 62(6), 1349‚Äì1382.
Newey, W. K., and McFadden, D. (1994), ‚ÄúLarge sample estimation and hypothesis testing,‚Äù in Handbook of
Econometrics, Vol. 4, Amsterdam: North-Holland: Elsevier, chapter 36, pp. 2111‚Äì2245.
Oreopoulos, P., von Wachter, T., and Heisz, A. (2012), ‚ÄúThe short- and long-term career effects of graduating in a
recession,‚Äù American Economic Journal: Applied Economics, 4(1), 1‚Äì29.
Qin, J., and Zhang, B. (2008), ‚ÄúEmpirical-likelihood-based difference-in-differences estimators,‚Äù Journal of the
Royal Statistical Society. Series B (Methodological), 75(8), 329‚Äì349.
Robins, J. M. (1986), ‚ÄúA new approach to causal inference in mortality studies with a sustained exposure period Application to control of the healthy worker survivor effect,‚Äù Mathematical Modelling, 7, 1393‚Äì1512.
Robins, J. M. (1987), ‚ÄúAddendum to ‚ÄòA new approach to causal inference in mortality studies with a sustained
exposure period - Application to control of the healthy worker survivor effect‚Äô,‚Äù Computers & Mathematics with
Applications, 14(9-12), 923‚Äì945.
Roth, J. (2020), ‚ÄúPre-test with caution: Event-study estimates after testing for parallel trends,‚Äù Working Paper,
pp. 1‚Äì84.
Rubin, D. B. (2007), ‚ÄúThe design versus the analysis of observational studies for causal effects: Parallels with the
design of randomized trials,‚Äù Statistics in Medicine, 26(1), 20‚Äì36.
Rubin, D. B. (2008), ‚ÄúFor objective causal inference, design trumps analysis,‚Äù Annals of Applied Statistics,
2(3), 808‚Äì840.
Sant‚ÄôAnna, P. H. C., and Song, X. (2019), ‚ÄúSpecification tests for the propensity score,‚Äù Journal of Econometrics,
210, 379‚Äì404.
Sant‚ÄôAnna, P. H., and Zhao, J. (2020), ‚ÄúDoubly robust difference-in-differences estimators,‚Äù Journal of Econometrics, 219(1), 101‚Äì122.
Sherman, M., and Le Cessie, S. (2007), ‚ÄúA comparison between bootstrap methods and generalized estimating
equations for correlated outcomes in generalized linear models,‚Äù Communications in Statistics - Simulation and
Computation, 26(3), 901‚Äì925.

44

Sianesi, B. (2004), ‚ÄúAn evaluation of the Swedish system of active labor market programs in the 1990s,‚Äù The Review
of Economics and Statistics, 86(1), 133‚Äì155.
SloczynÃÅski, T. (2018), ‚ÄúA general weighted average representation of the ordinary and two-stage least squares
estimands,‚Äù Working Paper.
Sun, L., and Abraham, S. (2020), ‚ÄúEstimating dynamic treatment effects in event studies with heterogeneous
treatment effects,‚Äù Working Paper.
van der Vaart, A. W. (1998), Asymptotic Statistics, Cambridge: Cambridge University Press.
van der Vaart, A. W., and Wellner, J. A. (1996), Weak Convergence and Empirical Processes, New York: Springer.
Wooldridge, J. M. (2003), ‚ÄúCluster-sample methods in applied econometrics,‚Äù American Economic Review P&P,
93(2), 133‚Äì138.
Wooldridge, J. M. (2005a), ‚ÄúFixed-effects and related estimators for correlated random-coefficient and treatmenteffect panel data models,‚Äù Review of Economics and Statistics, 87(2), 385‚Äì390.
Wooldridge, J. M. (2005b), ‚ÄúViolating ignorability of treatment by controlling for too many factors,‚Äù Econometric
Theory, 21(5), 1026‚Äì1028.
Wooldridge, J. M. (2007), ‚ÄúInverse probability weighted estimation for general missing data problems,‚Äù Journal of
Econometrics, 141(2), 1281‚Äì1301.
Yang, S., and Ding, P. (2018), ‚ÄúAsymptotic inference of causal effects with observational studies trimmed by the
estimated propensity scores,‚Äù Biometrika, 105(2), 487‚Äì493.

45

